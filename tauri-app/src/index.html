<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLX-Audio</title>
    <style>
:root{--bg:linear-gradient(135deg,#0f0f23,#1a0a2e);--surface:rgba(255,255,255,0.05);--surface2:rgba(255,255,255,0.1);--border:rgba(255,255,255,0.1);--text:#e8e8f0;--dim:#a0a0b0;--accent:#ec4899;--accent2:#8b5cf6;--green:#22c55e;--blue:#3b82f6;--orange:#f59e0b;--red:#ef4444}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
.header{text-align:center;padding:2rem 1rem 1rem}
.title{font-size:2.5rem;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.subtitle{color:var(--dim);margin-top:.5rem}
.container{max-width:900px;margin:0 auto;padding:1rem}
.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:2rem}
.metric-card{background:var(--surface);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:12px;padding:1.5rem;text-align:center;transition:all .3s}
.metric-card.success{background:rgba(34,197,94,0.1);border-color:var(--green)}
.metric-label{font-size:.8rem;color:var(--dim);margin-bottom:.5rem}
.metric-value{font-size:1.8rem;font-weight:600;color:var(--accent)}
.metric-unit{font-size:.9rem;color:var(--dim)}
.mode-toggle{display:flex;background:var(--surface);border-radius:12px;padding:.5rem;margin-bottom:2rem;border:1px solid var(--border)}
.mode-btn{flex:1;padding:1rem;border:none;background:transparent;color:var(--text);border-radius:8px;cursor:pointer;transition:all .3s;font-weight:500}
.mode-btn.active{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.card{background:var(--surface);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem}
.card-title{font-size:1.1rem;font-weight:600;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}
.form-group{margin-bottom:1rem}
.form-label{display:block;font-size:.85rem;color:var(--dim);margin-bottom:.5rem;font-weight:500}
input,select,textarea{width:100%;padding:.75rem;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:.9rem;transition:all .3s}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent);background:rgba(255,255,255,0.08)}
textarea{min-height:120px;resize:vertical}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.slider-group{display:flex;align-items:center;gap:1rem}
.slider{flex:1;-webkit-appearance:none;height:6px;background:rgba(255,255,255,0.1);border-radius:3px;border:none}
.slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;cursor:pointer}
.slider-value{min-width:3rem;text-align:right;font-weight:600;color:var(--accent)}
.btn{width:100%;padding:1rem;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:8px;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:.5rem}
.btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(236,72,153,0.3)}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.btn-secondary{background:var(--surface);border:1px solid var(--border);color:var(--text)}
.btn-secondary:hover{background:var(--surface2)}
.switch{position:relative;display:inline-block;width:50px;height:24px}
.switch input{opacity:0;width:0;height:0}
.switch-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.1);transition:.4s;border-radius:24px}
.switch-slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background:white;transition:.4s;border-radius:50%}
input:checked + .switch-slider{background:linear-gradient(135deg,var(--accent),var(--accent2))}
input:checked + .switch-slider:before{transform:translateX(26px)}
.upload-zone{border:2px dashed var(--border);border-radius:12px;padding:3rem;text-align:center;cursor:pointer;transition:all .3s;background:rgba(255,255,255,0.02)}
.upload-zone:hover,.upload-zone.dragover{border-color:var(--accent);background:rgba(236,72,153,0.1)}
.upload-icon{font-size:3rem;margin-bottom:1rem}
.result-area{margin-top:1.5rem}
.result-text{background:rgba(255,255,255,0.05);border-radius:8px;padding:1rem;font-family:monospace;white-space:pre-wrap;max-height:400px;overflow-y:auto;border:1px solid var(--border);line-height:1.6}
.result-text::-webkit-scrollbar{width:8px}
.result-text::-webkit-scrollbar-track{background:var(--surface2);border-radius:4px}
.result-text::-webkit-scrollbar-thumb{background:var(--accent);border-radius:4px}
.result-text::-webkit-scrollbar-thumb:hover{background:var(--accent2)}
audio{width:100%;margin-top:1rem;border-radius:8px}
.status-indicator{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:20px;font-size:.8rem;font-weight:500}
.status-indicator.ready{background:rgba(34,197,94,0.2);color:var(--green)}
.status-indicator.processing{background:rgba(245,158,11,0.2);color:var(--orange)}
.status-indicator.error{background:rgba(239,68,68,0.2);color:var(--red)}
.hidden{display:none}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.loading{animation:spin 1s linear infinite}
.pulsing{animation:pulse 2s ease-in-out infinite}
.progress-bar{width:100%;height:4px;background:rgba(255,255,255,0.1);border-radius:2px;overflow:hidden;margin-top:1rem}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%;transition:width .3s}
    </style>
</head>
<body>
<div class="header">
    <div style="position:absolute;top:1rem;right:1rem">
        <select id="language-selector" onchange="setLanguage(this.value)" style="padding:0.5rem;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:0.85rem">
            <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
            <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
        </select>
    </div>
    <h1 class="title">MLX-Audio</h1>
    <p class="subtitle" data-i18n="subtitle">High-performance speech processing on Apple Silicon</p>
</div>

<div class="container">
    <!-- æ€§èƒ½æŒ‡æ ‡å¡ç‰‡ -->
    <div class="metrics-grid">
        <div class="metric-card" id="ttfb-card">
            <div class="metric-label" data-i18n="metric.ttfb">First Byte Latency</div>
            <div class="metric-value" id="ttfb-value">--</div>
            <div class="metric-unit">ms</div>
        </div>
        <div class="metric-card" id="start-card">
            <div class="metric-label" data-i18n="metric.start">Playback Start Time</div>
            <div class="metric-value" id="start-value">--</div>
            <div class="metric-unit">ms</div>
        </div>
        <div class="metric-card" id="total-card">
            <div class="metric-label" data-i18n="metric.total">Total Processing Time</div>
            <div class="metric-value" id="total-value">--</div>
            <div class="metric-unit">ms</div>
        </div>
        <div class="metric-card" id="size-card">
            <div class="metric-label" data-i18n="metric.size">Data Size</div>
            <div class="metric-value" id="size-value">--</div>
            <div class="metric-unit">KB</div>
        </div>
    </div>

    <!-- æ¨¡å‹ç®¡ç† - ç´§å‡‘ç‰ˆ -->
    <div style="display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:var(--surface);border:1px solid var(--border);border-radius:8px;margin-bottom:1.5rem;font-size:.85rem">
        <div style="display:flex;gap:2rem">
            <div>
                <span style="color:var(--dim)" data-i18n="model.tts">TTS:</span>
                <span id="tts-models-compact">--</span>
            </div>
            <div>
                <span style="color:var(--dim)" data-i18n="model.stt">STT:</span>
                <span id="stt-models-compact">--</span>
            </div>
        </div>
        <div style="display:flex;gap:1rem;align-items:center">
            <span style="color:var(--dim)" data-i18n="model.memory">å†…å­˜:</span>
            <span id="memory-compact" style="color:var(--accent);font-weight:600">--</span>
            <button onclick="toggleModelManager()" style="padding:.25rem .75rem;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;font-size:.8rem" data-i18n="model.manage">ç®¡ç†</button>
        </div>
    </div>

    <!-- è¯¦ç»†æ¨¡å‹ç®¡ç†é¢æ¿ -->
    <div id="model-manager" class="card hidden" style="margin-bottom:1.5rem">
        <div style="margin-bottom:1rem;padding:.75rem;background:var(--surface2);border-radius:6px">
            <div style="font-size:.9rem;margin-bottom:.5rem" data-i18n="api.title">ğŸ”— API Connection Test</div>
            <div style="display:flex;gap:.5rem;align-items:center">
                <input type="text" id="api-url" value="http://127.0.0.1:8002" style="flex:1;padding:.5rem;background:var(--surface);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:.85rem">
                <button onclick="testAPI()" style="padding:.5rem 1rem;background:var(--accent);border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:.85rem" data-i18n="api.test">Test</button>
            </div>
            <div id="api-test-result" style="margin-top:.5rem;font-size:.8rem;color:var(--dim)"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
            <div>
                <div style="font-size:.9rem;color:var(--dim);margin-bottom:.5rem" data-i18n="model.ttsModels">TTS Models</div>
                <div id="tts-models-list"></div>
            </div>
            <div>
                <div style="font-size:.9rem;color:var(--dim);margin-bottom:.5rem" data-i18n="model.sttModels">STT Models</div>
                <div id="stt-models-list"></div>
            </div>
        </div>
    </div>

    <!-- æ¨¡å¼åˆ‡æ¢ -->
    <div class="mode-toggle">
        <button class="mode-btn active" onclick="setMode('tts')" id="mode-tts" data-i18n="mode.tts">ğŸ“ æ–‡å­—è½¬è¯­éŸ³</button>
        <button class="mode-btn" onclick="setMode('stt')" id="mode-stt" data-i18n="mode.stt">ğŸ¤ è¯­éŸ³è½¬æ–‡å­—</button>
    </div>

    <!-- TTS é¢æ¿ -->
    <div id="panel-tts">
        <div class="card">
            <div class="card-title" data-i18n="tts.settings">ğŸ¯ ç”Ÿæˆè®¾ç½®</div>
            <div class="form-group">
                <label class="form-label" data-i18n="tts.model">TTSæ¨¡å‹</label>
                <select id="tts-model">
                    <option value="mlx-community/Kokoro-82M-bf16" selected data-i18n="tts.model.kokoro">Kokoro-82M (æ¨è)</option>
                    <option value="mlx-community/Kokoro-82M-4bit" data-i18n="tts.model.kokoro4bit">Kokoro-82M-4bit (é‡åŒ–ç‰ˆ)</option>
                </select>
                <div class="form-hint" data-i18n="tts.model.hint">æ”¯æŒä¸­è‹±æ—¥ç­‰9ç§è¯­è¨€ï¼Œ54ä¸ªå£°éŸ³</div>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="tts.text">è¾“å…¥æ–‡æœ¬</label>
                <textarea id="tts-text" data-i18n-placeholder="tts.text.placeholder" placeholder="è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡å­—...">It is not the critic who counts... The credit belongs to the man who is actually in the arena, whose face is marred by dust and sweat and blood; who strives valiantly; who errs, who comes short again and again... who at the best knows in the end the triumph of high achievement, and who at the worst, if he fails, at least fails while daring greatly.</textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" data-i18n="tts.language">è¯­è¨€</label>
                    <select id="tts-lang" onchange="updateVoices()">
                        <option value="a" selected>ğŸ‡ºğŸ‡¸ English (US)</option>
                        <option value="b">ğŸ‡¬ğŸ‡§ English (UK)</option>
                        <option value="z">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                        <option value="j">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                        <option value="e">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                        <option value="f">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                        <option value="h">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                        <option value="i">ğŸ‡®ğŸ‡¹ Italiano</option>
                        <option value="p">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="tts.voice">å£°éŸ³</label>
                    <select id="tts-voice"></select>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label"><span data-i18n="tts.speed">è¯­é€Ÿ:</span> <span id="speed-val">1.0</span>x</label>
                <div class="slider-group">
                    <input type="range" class="slider" id="tts-speed" min="0.5" max="2" step="0.1" value="1" oninput="updateSpeed(this.value)">
                    <span class="slider-value" id="speed-display">1.0x</span>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" style="display:flex;align-items:center;gap:1rem">
                    <span data-i18n="tts.streaming">æµå¼æ’­æ”¾æ¨¡å¼ï¼ˆæ¨èï¼‰</span>
                    <label class="switch">
                        <input type="checkbox" id="streaming-toggle" checked>
                        <span class="switch-slider"></span>
                    </label>
                </label>
            </div>
        </div>

        <button class="btn" onclick="generateTTS()" id="tts-btn">
            <span>â–¶</span> <span data-i18n="tts.generate">ç”Ÿæˆè¯­éŸ³</span>
        </button>
        
        <div class="progress-bar hidden" id="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <div class="result-area">
            <div class="status-indicator ready hidden" id="status-indicator">
                <span>âœ“</span> <span data-i18n="status.complete">Generation Complete</span>
            </div>
            <canvas id="waveform" class="hidden" width="800" height="100" style="width:100%;height:100px;background:#1a1a24;border-radius:8px;margin-bottom:1rem"></canvas>
            <audio id="tts-audio" controls class="hidden"></audio>
            <button class="btn btn-secondary hidden" onclick="downloadAudio()" id="download-btn" style="margin-top:1rem">
                <span>â¬‡ï¸</span> <span data-i18n="tts.download">ä¸‹è½½éŸ³é¢‘</span>
            </button>
        </div>
    </div>

    <!-- STT é¢æ¿ -->
    <div id="panel-stt" class="hidden">
        <div class="card">
            <div class="upload-zone" id="upload-zone" onclick="document.getElementById('stt-file').click()">
                <div class="upload-icon">ğŸµ</div>
                <div data-i18n="stt.upload">æ‹–æ‹½éŸ³é¢‘æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </div>
                <div style="margin-top:.5rem;font-size:.8rem;color:var(--dim)" data-i18n="stt.formats">æ”¯æŒ WAV, MP3, FLAC, M4A</div>
            </div>
            <input type="file" id="stt-file" accept="audio/*" class="hidden" onchange="handleFileSelect(this)">
            <div id="file-name" class="hidden" style="margin-top:1rem;text-align:center"></div>
        </div>
        
        <div class="card">
            <div class="card-title" data-i18n="stt.settings">ğŸ¯ è½¬å½•è®¾ç½®</div>
            <div class="form-group">
                <label class="form-label" data-i18n="stt.model">Whisperæ¨¡å‹</label>
                <select id="stt-model">
                    <option value="mlx-community/whisper-large-v3-turbo" selected data-i18n="stt.model.turbo">Turbo (æ¨è)</option>
                    <option value="mlx-community/whisper-large-v3-mlx-4bit">Large-4bit</option>
                    <option value="mlx-community/whisper-medium-mlx-4bit">Medium-4bit</option>
                    <option value="mlx-community/whisper-small-mlx-4bit">Small-4bit</option>
                    <option value="mlx-community/whisper-base-mlx-4bit">Base-4bit</option>
                    <option value="mlx-community/whisper-tiny-mlx-4bit">Tiny-4bit</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="stt.language">è¯­è¨€</label>
                <select id="stt-lang">
                    <option value="" data-i18n="stt.language.auto">è‡ªåŠ¨æ£€æµ‹</option>
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">English</option>
                    <option value="ja">æ—¥æœ¬èª</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label"><span data-i18n="stt.prompt">æç¤ºè¯</span> <span id="prompt-count" style="color:var(--dim);font-size:.8rem">(0/900)</span></label>
                <textarea id="stt-prompt" data-i18n-placeholder="stt.prompt.placeholder" placeholder="è¾“å…¥ä¸“ä¸šæœ¯è¯­ã€äººåã€åœ°åç­‰" rows="5" oninput="updatePromptCount()">æ ‡ç‚¹ï¼šHello, hi! Yes? No. Thank you. ä½ å¥½ï¼Œè°¢è°¢ï¼æ˜¯çš„ã€‚äº‘è®¡ç®—ï¼šAWS, Azure, GCP, S3, EC2, Lambda, CloudFront, ECS, EKS, RDS, DynamoDB, SageMaker, Bedrock. å¤§æ•°æ®ï¼šKafka, Flink, Spark, Hadoop, Hive, Presto, Airflow, EMR, Glue, Athena, Redshift, Kinesis. AI/MLï¼šOpenAI, ChatGPT, Claude, Gemini, GPT-4, Whisper, TensorFlow, PyTorch, MLX, LLM, RAG, Vector, Embedding. å¼€å‘ï¼šPython, JavaScript, TypeScript, Java, Go, Rust, React, Vue, Node.js, Docker, Kubernetes, Git, GitHub, GitLab, CI/CD, API, REST, GraphQL, gRPC. èŒåœºï¼šannounce, confirm, schedule, meeting, deadline, deliverable, stakeholder, alignment, sync-up, follow-up, action item, escalate, prioritize, bandwidth, capacity. å…¬å¸ï¼šAmazon, Google, Microsoft, Meta, Apple, Netflix, Uber, Airbnb, Salesforce, Oracle, IBM, SAP. äººåï¼šNeo, Damon, Jason, Kevin, Kenny, Rob, Eric, Richard, Michelle, Ken.</textarea>
                <div class="form-hint" data-i18n="stt.prompt.hint">ğŸ’¡ åŒ…å«æ ‡ç‚¹+ä¸“ä¸šæœ¯è¯­+äººåå¯å¤§å¹…æé«˜å‡†ç¡®ç‡ã€‚å¯æ ¹æ®åœºæ™¯è‡ªå®šä¹‰</div>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="stt.format">è¾“å‡ºæ ¼å¼</label>
                <select id="stt-format">
                    <option value="text" selected data-i18n="stt.format.text">çº¯æ–‡æœ¬</option>
                    <option value="json" data-i18n="stt.format.json">JSON (è¯¦ç»†ä¿¡æ¯)</option>
                    <option value="srt" data-i18n="stt.format.srt">SRTå­—å¹•</option>
                    <option value="vtt" data-i18n="stt.format.vtt">VTTå­—å¹•</option>
                </select>
            </div>
        </div>

        <button class="btn" onclick="transcribe()" id="stt-btn">
            <span>â–¶</span> <span data-i18n="stt.transcribe">å¼€å§‹è½¬å½•</span>
        </button>
        
        <div class="result-area">
            <div id="stt-progress" class="hidden" style="margin-bottom:1rem">
                <div style="display:flex;justify-content:space-between;margin-bottom:0.5rem">
                    <span data-i18n="status.processing">å¤„ç†ä¸­...</span>
                    <span id="stt-progress-text">0%</span>
                </div>
                <div style="width:100%;height:4px;background:var(--surface2);border-radius:2px;overflow:hidden">
                    <div id="stt-progress-bar" style="width:0%;height:100%;background:linear-gradient(90deg,#ec4899,#8b5cf6);transition:width 0.3s"></div>
                </div>
            </div>
            <canvas id="stt-waveform" class="hidden" width="800" height="100" style="width:100%;height:100px;background:#1a1a24;border-radius:8px;margin-bottom:1rem"></canvas>
            <audio id="stt-audio" controls class="hidden" style="width:100%;margin-bottom:1rem"></audio>
            <div id="stt-result" class="result-text hidden"></div>
        </div>
    </div>

</div>

<script>
// APIåŸºç¡€URLé…ç½®ï¼ˆå…¨å±€å˜é‡ï¼‰
// Tauriç¯å¢ƒæ£€æµ‹ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯file://æˆ–tauri://åè®®
const IS_TAURI_ENV = window.location.protocol === 'tauri:' || (window.location.protocol === 'https:' && window.location.hostname === 'tauri.localhost');
let API_BASE = IS_TAURI_ENV ? 'http://127.0.0.1:8002' : '';
console.log('Is Tauri:', IS_TAURI_ENV);
console.log('Protocol:', window.location.protocol);
console.log('API_BASE:', API_BASE);

// i18n Translation System
const i18n = {
    'zh-CN': {
        subtitle: 'Apple Silicon ä¸Šçš„é«˜æ€§èƒ½è¯­éŸ³å¤„ç†',
        'metric.ttfb': 'é¦–å­—èŠ‚å»¶è¿Ÿ',
        'metric.start': 'å¼€å§‹æ’­æ”¾æ—¶é—´',
        'metric.total': 'æ€»å¤„ç†æ—¶é—´',
        'metric.size': 'æ•°æ®å¤§å°',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'å†…å­˜:',
        'model.manage': 'ç®¡ç†',
        'mode.tts': 'ğŸ“ æ–‡å­—è½¬è¯­éŸ³',
        'mode.stt': 'ğŸ¤ è¯­éŸ³è½¬æ–‡å­—',
        'mode.blend': 'ğŸ¨ å£°éŸ³æ··åˆ',
        'tts.settings': 'ğŸ¯ ç”Ÿæˆè®¾ç½®',
        'tts.model': 'TTSæ¨¡å‹',
        'tts.model.kokoro': 'Kokoro-82M (æ¨è)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (é‡åŒ–ç‰ˆ)',
        'tts.model.hint': 'æ”¯æŒä¸­è‹±æ—¥ç­‰9ç§è¯­è¨€ï¼Œ54ä¸ªå£°éŸ³',
        'tts.text': 'è¾“å…¥æ–‡æœ¬',
        'tts.text.placeholder': 'è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡å­—...',
        'tts.language': 'è¯­è¨€',
        'tts.voice': 'å£°éŸ³',
        'tts.speed': 'è¯­é€Ÿ:',
        'tts.streaming': 'æµå¼æ’­æ”¾æ¨¡å¼ï¼ˆæ¨èï¼‰',
        'tts.generate': 'ç”Ÿæˆè¯­éŸ³',
        'tts.generating': 'ç”Ÿæˆä¸­...',
        'tts.download': 'ä¸‹è½½éŸ³é¢‘',
        'status.complete': 'ç”Ÿæˆå®Œæˆ',
        'status.processing': 'å¤„ç†ä¸­...',
        'status.error': 'é”™è¯¯',
        'model.notLoaded': 'æœªåŠ è½½',
        'model.unload': 'å¸è½½',
        'api.testing': 'æµ‹è¯•ä¸­...',
        'api.success': 'è¿æ¥æˆåŠŸ',
        'api.failed': 'è¿æ¥å¤±è´¥',
        'api.models': 'æ¨¡å‹',
        'api.memory': 'å†…å­˜',
        'api.title': 'ğŸ”— APIè¿æ¥æµ‹è¯•',
        'api.test': 'æµ‹è¯•',
        'model.ttsModels': 'TTSæ¨¡å‹',
        'model.sttModels': 'STTæ¨¡å‹',
        'stt.transcribe': 'å¼€å§‹è½¬å½•',
        'stt.transcribing': 'è½¬å½•ä¸­...',
        'stt.upload': 'æ‹–æ‹½éŸ³é¢‘æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ ',
        'stt.formats': 'æ”¯æŒ WAV, MP3, FLAC, M4A',
        'stt.settings': 'ğŸ¯ è½¬å½•è®¾ç½®',
        'blend.blending': 'æ··åˆå¹¶ç”Ÿæˆä¸­...',
        'stt.model': 'Whisperæ¨¡å‹',
        'stt.model.turbo': 'Turbo (æ¨è)',
        'stt.language': 'è¯­è¨€',
        'stt.language.auto': 'è‡ªåŠ¨æ£€æµ‹',
        'stt.prompt': 'æç¤ºè¯',
        'stt.prompt.placeholder': 'è¾“å…¥ä¸“ä¸šæœ¯è¯­ã€äººåã€åœ°åç­‰',
        'stt.prompt.hint': 'ğŸ’¡ åŒ…å«æ ‡ç‚¹+ä¸“ä¸šæœ¯è¯­+äººåå¯å¤§å¹…æé«˜å‡†ç¡®ç‡ã€‚å¯æ ¹æ®åœºæ™¯è‡ªå®šä¹‰',
        'stt.format': 'è¾“å‡ºæ ¼å¼',
        'stt.format.text': 'çº¯æ–‡æœ¬',
        'stt.format.json': 'JSON (è¯¦ç»†ä¿¡æ¯)',
        'stt.format.srt': 'SRTå­—å¹•',
        'stt.format.vtt': 'VTTå­—å¹•',
        'stt.transcribe': 'å¼€å§‹è½¬å½•',
        'blend.language': 'è¯­è¨€',
        'blend.voice1': 'å£°éŸ³1',
        'blend.weight1': 'æƒé‡1:',
        'blend.voice2': 'å£°éŸ³2',
        'blend.weight2': 'æƒé‡2:',
        'blend.test': 'æµ‹è¯•æ–‡æœ¬',
        'blend.test.placeholder': 'è¾“å…¥æµ‹è¯•æ–‡æœ¬',
        'blend.generate': 'æ··åˆå¹¶æµ‹è¯•'
    },
    'zh-TW': {
        subtitle: 'Apple Silicon ä¸Šçš„é«˜æ€§èƒ½èªéŸ³è™•ç†',
        'metric.ttfb': 'é¦–å­—ç¯€å»¶é²',
        'metric.start': 'é–‹å§‹æ’­æ”¾æ™‚é–“',
        'metric.total': 'ç¸½è™•ç†æ™‚é–“',
        'metric.size': 'æ•¸æ“šå¤§å°',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'å…§å­˜:',
        'model.manage': 'ç®¡ç†',
        'mode.tts': 'ğŸ“ æ–‡å­—è½‰èªéŸ³',
        'mode.stt': 'ğŸ¤ èªéŸ³è½‰æ–‡å­—',
        'mode.blend': 'ğŸ¨ è²éŸ³æ··åˆ',
        'tts.settings': 'ğŸ¯ ç”Ÿæˆè¨­ç½®',
        'tts.model': 'TTSæ¨¡å‹',
        'tts.model.kokoro': 'Kokoro-82M (æ¨è–¦)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (é‡åŒ–ç‰ˆ)',
        'tts.model.hint': 'æ”¯æŒä¸­è‹±æ—¥ç­‰9ç¨®èªè¨€ï¼Œ54å€‹è²éŸ³',
        'tts.text': 'è¼¸å…¥æ–‡æœ¬',
        'tts.text.placeholder': 'è«‹è¼¸å…¥è¦è½‰æ›çš„æ–‡å­—...',
        'tts.language': 'èªè¨€',
        'tts.voice': 'è²éŸ³',
        'tts.speed': 'èªé€Ÿ:',
        'tts.streaming': 'æµå¼æ’­æ”¾æ¨¡å¼ï¼ˆæ¨è–¦ï¼‰',
        'tts.generate': 'ç”ŸæˆèªéŸ³',
        'tts.download': 'ä¸‹è¼‰éŸ³é »',
        'status.complete': 'ç”Ÿæˆå®Œæˆ',
        'status.processing': 'è™•ç†ä¸­...',
        'stt.upload': 'æ‹–æ‹½éŸ³é »æ–‡ä»¶åˆ°æ­¤è™•æˆ–é»æ“Šä¸Šå‚³',
        'stt.formats': 'æ”¯æŒ WAV, MP3, FLAC, M4A',
        'stt.settings': 'ğŸ¯ è½‰éŒ„è¨­ç½®',
        'stt.model': 'Whisperæ¨¡å‹',
        'stt.model.turbo': 'Turbo (æ¨è–¦)',
        'stt.language': 'èªè¨€',
        'stt.language.auto': 'è‡ªå‹•æª¢æ¸¬',
        'stt.prompt': 'æç¤ºè©',
        'stt.prompt.placeholder': 'è¼¸å…¥å°ˆæ¥­è¡“èªã€äººåã€åœ°åç­‰',
        'stt.prompt.hint': 'ğŸ’¡ åŒ…å«æ¨™é»+å°ˆæ¥­è¡“èª+äººåå¯å¤§å¹…æé«˜æº–ç¢ºç‡ã€‚å¯æ ¹æ“šå ´æ™¯è‡ªå®šç¾©',
        'stt.format': 'è¼¸å‡ºæ ¼å¼',
        'stt.format.text': 'ç´”æ–‡æœ¬',
        'stt.format.json': 'JSON (è©³ç´°ä¿¡æ¯)',
        'stt.format.srt': 'SRTå­—å¹•',
        'stt.format.vtt': 'VTTå­—å¹•',
        'stt.transcribe': 'é–‹å§‹è½‰éŒ„',
        'blend.language': 'èªè¨€',
        'blend.voice1': 'è²éŸ³1',
        'blend.weight1': 'æ¬Šé‡1:',
        'blend.voice2': 'è²éŸ³2',
        'blend.weight2': 'æ¬Šé‡2:',
        'blend.test': 'æ¸¬è©¦æ–‡æœ¬',
        'blend.test.placeholder': 'è¼¸å…¥æ¸¬è©¦æ–‡æœ¬',
        'blend.generate': 'æ··åˆä¸¦æ¸¬è©¦'
    },
    'en': {
        subtitle: 'High-performance speech processing on Apple Silicon',
        'metric.ttfb': 'First Byte Latency',
        'metric.start': 'Playback Start Time',
        'metric.total': 'Total Processing Time',
        'metric.size': 'Data Size',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'Memory:',
        'model.manage': 'Manage',
        'mode.tts': 'ğŸ“ Text to Speech',
        'mode.stt': 'ğŸ¤ Speech to Text',
        'mode.blend': 'ğŸ¨ Voice Blending',
        'tts.settings': 'ğŸ¯ Generation Settings',
        'tts.model': 'TTS Model',
        'tts.model.kokoro': 'Kokoro-82M (Recommended)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (Quantized)',
        'tts.model.hint': 'Supports 9 languages including Chinese, English, Japanese with 54 voices',
        'tts.text': 'Input Text',
        'tts.text.placeholder': 'Enter text to convert...',
        'tts.language': 'Language',
        'tts.voice': 'Voice',
        'tts.speed': 'Speed:',
        'tts.streaming': 'Streaming Mode (Recommended)',
        'tts.generate': 'Generate Speech',
        'tts.generating': 'Generating...',
        'tts.download': 'Download Audio',
        'status.complete': 'Generation Complete',
        'status.processing': 'Processing...',
        'status.error': 'Error',
        'model.notLoaded': 'Not Loaded',
        'model.unload': 'Unload',
        'api.testing': 'Testing...',
        'api.success': 'Connected',
        'api.failed': 'Failed',
        'api.models': 'Models',
        'api.memory': 'Memory',
        'api.title': 'ğŸ”— API Connection Test',
        'api.test': 'Test',
        'model.ttsModels': 'TTS Models',
        'model.sttModels': 'STT Models',
        'stt.transcribe': 'Start Transcription',
        'stt.transcribing': 'Transcribing...',
        'stt.upload': 'Drag audio files here or click to upload',
        'stt.formats': 'Supports WAV, MP3, FLAC, M4A',
        'blend.blending': 'Blending and Generating...',
        'stt.settings': 'ğŸ¯ Transcription Settings',
        'stt.model': 'Whisper Model',
        'stt.model.turbo': 'Turbo (Recommended)',
        'stt.language': 'Language',
        'stt.language.auto': 'Auto Detect',
        'stt.prompt': 'Prompt',
        'stt.prompt.placeholder': 'Enter technical terms, names, places, etc.',
        'stt.prompt.hint': 'ğŸ’¡ Including punctuation + technical terms + names can significantly improve accuracy. Customize based on scenario',
        'stt.format': 'Output Format',
        'stt.format.text': 'Plain Text',
        'stt.format.json': 'JSON (Detailed)',
        'stt.format.srt': 'SRT Subtitles',
        'stt.format.vtt': 'VTT Subtitles',
        'stt.transcribe': 'Start Transcription',
        'blend.language': 'Language',
        'blend.voice1': 'Voice 1',
        'blend.weight1': 'Weight 1:',
        'blend.voice2': 'Voice 2',
        'blend.weight2': 'Weight 2:',
        'blend.test': 'Test Text',
        'blend.test.placeholder': 'Enter test text',
        'blend.generate': 'Blend and Test'
    },
    'ja': {
        subtitle: 'Apple Silicon ã§ã®é«˜æ€§èƒ½éŸ³å£°å‡¦ç†',
        'metric.ttfb': 'åˆå›ãƒã‚¤ãƒˆé…å»¶',
        'metric.start': 'å†ç”Ÿé–‹å§‹æ™‚é–“',
        'metric.total': 'ç·å‡¦ç†æ™‚é–“',
        'metric.size': 'ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'ãƒ¡ãƒ¢ãƒª:',
        'model.manage': 'ç®¡ç†',
        'mode.tts': 'ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆèª­ã¿ä¸Šã’',
        'mode.stt': 'ğŸ¤ éŸ³å£°èªè­˜',
        'mode.blend': 'ğŸ¨ éŸ³å£°ãƒ–ãƒ¬ãƒ³ãƒ‰',
        'tts.settings': 'ğŸ¯ ç”Ÿæˆè¨­å®š',
        'tts.model': 'TTSãƒ¢ãƒ‡ãƒ«',
        'tts.model.kokoro': 'Kokoro-82M (æ¨å¥¨)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (é‡å­åŒ–ç‰ˆ)',
        'tts.model.hint': 'ä¸­è‹±æ—¥ãªã©9è¨€èªã€54éŸ³å£°ã‚’ã‚µãƒãƒ¼ãƒˆ',
        'tts.text': 'å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ',
        'tts.text.placeholder': 'å¤‰æ›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...',
        'tts.language': 'è¨€èª',
        'tts.voice': 'éŸ³å£°',
        'tts.speed': 'é€Ÿåº¦:',
        'tts.streaming': 'ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆæ¨å¥¨ï¼‰',
        'tts.generate': 'éŸ³å£°ç”Ÿæˆ',
        'tts.download': 'ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
        'status.complete': 'ç”Ÿæˆå®Œäº†',
        'status.processing': 'å‡¦ç†ä¸­...',
        'stt.upload': 'ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
        'stt.formats': 'WAV, MP3, FLAC, M4Aå¯¾å¿œ',
        'stt.settings': 'ğŸ¯ è»¢å†™è¨­å®š',
        'stt.model': 'Whisperãƒ¢ãƒ‡ãƒ«',
        'stt.model.turbo': 'Turbo (æ¨å¥¨)',
        'stt.language': 'è¨€èª',
        'stt.language.auto': 'è‡ªå‹•æ¤œå‡º',
        'stt.prompt': 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ',
        'stt.prompt.placeholder': 'å°‚é–€ç”¨èªã€äººåã€åœ°åç­‰ã‚’å…¥åŠ›',
        'stt.prompt.hint': 'ğŸ’¡ å¥èª­ç‚¹+å°‚é–€ç”¨èª+äººåã‚’å«ã‚ã‚‹ã¨ç²¾åº¦ãŒå¤§å¹…å‘ä¸Šã€‚ã‚·ãƒŠãƒªã‚ªã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º',
        'stt.format': 'å‡ºåŠ›å½¢å¼',
        'stt.format.text': 'ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ',
        'stt.format.json': 'JSON (è©³ç´°)',
        'stt.format.srt': 'SRTå­—å¹•',
        'stt.format.vtt': 'VTTå­—å¹•',
        'stt.transcribe': 'è»¢å†™é–‹å§‹',
        'blend.language': 'è¨€èª',
        'blend.voice1': 'éŸ³å£°1',
        'blend.weight1': 'é‡ã¿1:',
        'blend.voice2': 'éŸ³å£°2',
        'blend.weight2': 'é‡ã¿2:',
        'blend.test': 'ãƒ†ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆ',
        'blend.test.placeholder': 'ãƒ†ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›',
        'blend.generate': 'ãƒ–ãƒ¬ãƒ³ãƒ‰ã—ã¦ãƒ†ã‚¹ãƒˆ'
    },
    'ko': {
        subtitle: 'Apple Siliconì—ì„œì˜ ê³ ì„±ëŠ¥ ìŒì„± ì²˜ë¦¬',
        'metric.ttfb': 'ì²« ë°”ì´íŠ¸ ì§€ì—°ì‹œê°„',
        'metric.start': 'ì¬ìƒ ì‹œì‘ ì‹œê°„',
        'metric.total': 'ì´ ì²˜ë¦¬ ì‹œê°„',
        'metric.size': 'ë°ì´í„° í¬ê¸°',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'ë©”ëª¨ë¦¬:',
        'model.manage': 'ê´€ë¦¬',
        'mode.tts': 'ğŸ“ í…ìŠ¤íŠ¸ ìŒì„± ë³€í™˜',
        'mode.stt': 'ğŸ¤ ìŒì„± í…ìŠ¤íŠ¸ ë³€í™˜',
        'mode.blend': 'ğŸ¨ ìŒì„± ë¸”ë Œë”©',
        'tts.settings': 'ğŸ¯ ìƒì„± ì„¤ì •',
        'tts.model': 'TTS ëª¨ë¸',
        'tts.model.kokoro': 'Kokoro-82M (ê¶Œì¥)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (ì–‘ìí™” ë²„ì „)',
        'tts.model.hint': 'ì¤‘êµ­ì–´, ì˜ì–´, ì¼ë³¸ì–´ ë“± 9ê°œ ì–¸ì–´, 54ê°œ ìŒì„± ì§€ì›',
        'tts.text': 'ì…ë ¥ í…ìŠ¤íŠ¸',
        'tts.text.placeholder': 'ë³€í™˜í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...',
        'tts.language': 'ì–¸ì–´',
        'tts.voice': 'ìŒì„±',
        'tts.speed': 'ì†ë„:',
        'tts.streaming': 'ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œ (ê¶Œì¥)',
        'tts.generate': 'ìŒì„± ìƒì„±',
        'tts.download': 'ì˜¤ë””ì˜¤ ë‹¤ìš´ë¡œë“œ',
        'status.complete': 'ìƒì„± ì™„ë£Œ',
        'status.processing': 'ì²˜ë¦¬ ì¤‘...',
        'stt.upload': 'ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ',
        'stt.formats': 'WAV, MP3, FLAC, M4A ì§€ì›',
        'stt.settings': 'ğŸ¯ ì „ì‚¬ ì„¤ì •',
        'stt.model': 'Whisper ëª¨ë¸',
        'stt.model.turbo': 'Turbo (ê¶Œì¥)',
        'stt.language': 'ì–¸ì–´',
        'stt.language.auto': 'ìë™ ê°ì§€',
        'stt.prompt': 'í”„ë¡¬í”„íŠ¸',
        'stt.prompt.placeholder': 'ì „ë¬¸ ìš©ì–´, ì´ë¦„, ì¥ì†Œ ë“± ì…ë ¥',
        'stt.prompt.hint': 'ğŸ’¡ êµ¬ë‘ì +ì „ë¬¸ìš©ì–´+ì´ë¦„ì„ í¬í•¨í•˜ë©´ ì •í™•ë„ê°€ í¬ê²Œ í–¥ìƒë©ë‹ˆë‹¤. ì‹œë‚˜ë¦¬ì˜¤ì— ë”°ë¼ ì‚¬ìš©ì ì •ì˜',
        'stt.format': 'ì¶œë ¥ í˜•ì‹',
        'stt.format.text': 'ì¼ë°˜ í…ìŠ¤íŠ¸',
        'stt.format.json': 'JSON (ìƒì„¸)',
        'stt.format.srt': 'SRT ìë§‰',
        'stt.format.vtt': 'VTT ìë§‰',
        'stt.transcribe': 'ì „ì‚¬ ì‹œì‘',
        'blend.language': 'ì–¸ì–´',
        'blend.voice1': 'ìŒì„± 1',
        'blend.weight1': 'ê°€ì¤‘ì¹˜ 1:',
        'blend.voice2': 'ìŒì„± 2',
        'blend.weight2': 'ê°€ì¤‘ì¹˜ 2:',
        'blend.test': 'í…ŒìŠ¤íŠ¸ í…ìŠ¤íŠ¸',
        'blend.test.placeholder': 'í…ŒìŠ¤íŠ¸ í…ìŠ¤íŠ¸ ì…ë ¥',
        'blend.generate': 'ë¸”ë Œë“œ ë° í…ŒìŠ¤íŠ¸'
    },
    'de': {
        subtitle: 'Hochleistungs-Sprachverarbeitung auf Apple Silicon',
        'metric.ttfb': 'Erste-Byte-Latenz',
        'metric.start': 'Wiedergabe-Startzeit',
        'metric.total': 'Gesamtverarbeitungszeit',
        'metric.size': 'DatengrÃ¶ÃŸe',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'Speicher:',
        'model.manage': 'Verwalten',
        'mode.tts': 'ğŸ“ Text zu Sprache',
        'mode.stt': 'ğŸ¤ Sprache zu Text',
        'mode.blend': 'ğŸ¨ Stimmen-Mischung',
        'tts.settings': 'ğŸ¯ Generierungseinstellungen',
        'tts.model': 'TTS-Modell',
        'tts.model.kokoro': 'Kokoro-82M (Empfohlen)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (Quantisiert)',
        'tts.model.hint': 'UnterstÃ¼tzt 9 Sprachen inkl. Chinesisch, Englisch, Japanisch mit 54 Stimmen',
        'tts.text': 'Eingabetext',
        'tts.text.placeholder': 'Text zum Konvertieren eingeben...',
        'tts.language': 'Sprache',
        'tts.voice': 'Stimme',
        'tts.speed': 'Geschwindigkeit:',
        'tts.streaming': 'Streaming-Modus (Empfohlen)',
        'tts.generate': 'Sprache generieren',
        'tts.download': 'Audio herunterladen',
        'status.complete': 'Generierung abgeschlossen',
        'status.processing': 'Verarbeitung...',
        'stt.upload': 'Audiodateien hierher ziehen oder klicken zum Hochladen',
        'stt.formats': 'UnterstÃ¼tzt WAV, MP3, FLAC, M4A',
        'stt.settings': 'ğŸ¯ Transkriptionseinstellungen',
        'stt.model': 'Whisper-Modell',
        'stt.model.turbo': 'Turbo (Empfohlen)',
        'stt.language': 'Sprache',
        'stt.language.auto': 'Automatisch erkennen',
        'stt.prompt': 'Eingabeaufforderung',
        'stt.prompt.placeholder': 'Fachbegriffe, Namen, Orte usw. eingeben',
        'stt.prompt.hint': 'ğŸ’¡ Satzzeichen + Fachbegriffe + Namen kÃ¶nnen die Genauigkeit erheblich verbessern. Je nach Szenario anpassen',
        'stt.format': 'Ausgabeformat',
        'stt.format.text': 'Klartext',
        'stt.format.json': 'JSON (Detailliert)',
        'stt.format.srt': 'SRT-Untertitel',
        'stt.format.vtt': 'VTT-Untertitel',
        'stt.transcribe': 'Transkription starten',
        'blend.language': 'Sprache',
        'blend.voice1': 'Stimme 1',
        'blend.weight1': 'Gewicht 1:',
        'blend.voice2': 'Stimme 2',
        'blend.weight2': 'Gewicht 2:',
        'blend.test': 'Testtext',
        'blend.test.placeholder': 'Testtext eingeben',
        'blend.generate': 'Mischen und testen'
    },
    'fr': {
        subtitle: 'Traitement vocal haute performance sur Apple Silicon',
        'metric.ttfb': 'Latence du premier octet',
        'metric.start': 'Temps de dÃ©but de lecture',
        'metric.total': 'Temps de traitement total',
        'metric.size': 'Taille des donnÃ©es',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'MÃ©moire:',
        'model.manage': 'GÃ©rer',
        'mode.tts': 'ğŸ“ Texte vers parole',
        'mode.stt': 'ğŸ¤ Parole vers texte',
        'mode.blend': 'ğŸ¨ MÃ©lange de voix',
        'tts.settings': 'ğŸ¯ ParamÃ¨tres de gÃ©nÃ©ration',
        'tts.model': 'ModÃ¨le TTS',
        'tts.model.kokoro': 'Kokoro-82M (RecommandÃ©)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (QuantifiÃ©)',
        'tts.model.hint': 'Prend en charge 9 langues dont chinois, anglais, japonais avec 54 voix',
        'tts.text': 'Texte d\'entrÃ©e',
        'tts.text.placeholder': 'Entrez le texte Ã  convertir...',
        'tts.language': 'Langue',
        'tts.voice': 'Voix',
        'tts.speed': 'Vitesse:',
        'tts.streaming': 'Mode streaming (RecommandÃ©)',
        'tts.generate': 'GÃ©nÃ©rer la parole',
        'tts.download': 'TÃ©lÃ©charger l\'audio',
        'status.complete': 'GÃ©nÃ©ration terminÃ©e',
        'status.processing': 'Traitement en cours...',
        'stt.upload': 'Glissez les fichiers audio ici ou cliquez pour tÃ©lÃ©charger',
        'stt.formats': 'Prend en charge WAV, MP3, FLAC, M4A',
        'stt.settings': 'ğŸ¯ ParamÃ¨tres de transcription',
        'stt.model': 'ModÃ¨le Whisper',
        'stt.model.turbo': 'Turbo (RecommandÃ©)',
        'stt.language': 'Langue',
        'stt.language.auto': 'DÃ©tection automatique',
        'stt.prompt': 'Invite',
        'stt.prompt.placeholder': 'Entrez les termes techniques, noms, lieux, etc.',
        'stt.prompt.hint': 'ğŸ’¡ Inclure ponctuation + termes techniques + noms peut considÃ©rablement amÃ©liorer la prÃ©cision. Personnaliser selon le scÃ©nario',
        'stt.format': 'Format de sortie',
        'stt.format.text': 'Texte brut',
        'stt.format.json': 'JSON (DÃ©taillÃ©)',
        'stt.format.srt': 'Sous-titres SRT',
        'stt.format.vtt': 'Sous-titres VTT',
        'stt.transcribe': 'Commencer la transcription',
        'blend.language': 'Langue',
        'blend.voice1': 'Voix 1',
        'blend.weight1': 'Poids 1:',
        'blend.voice2': 'Voix 2',
        'blend.weight2': 'Poids 2:',
        'blend.test': 'Texte de test',
        'blend.test.placeholder': 'Entrez le texte de test',
        'blend.generate': 'MÃ©langer et tester'
    },
    'it': {
        subtitle: 'Elaborazione vocale ad alte prestazioni su Apple Silicon',
        'metric.ttfb': 'Latenza primo byte',
        'metric.start': 'Tempo di inizio riproduzione',
        'metric.total': 'Tempo di elaborazione totale',
        'metric.size': 'Dimensione dati',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'Memoria:',
        'model.manage': 'Gestisci',
        'mode.tts': 'ğŸ“ Testo in voce',
        'mode.stt': 'ğŸ¤ Voce in testo',
        'mode.blend': 'ğŸ¨ Miscelazione vocale',
        'tts.settings': 'ğŸ¯ Impostazioni generazione',
        'tts.model': 'Modello TTS',
        'tts.model.kokoro': 'Kokoro-82M (Consigliato)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (Quantizzato)',
        'tts.model.hint': 'Supporta 9 lingue incluso cinese, inglese, giapponese con 54 voci',
        'tts.text': 'Testo di input',
        'tts.text.placeholder': 'Inserisci il testo da convertire...',
        'tts.language': 'Lingua',
        'tts.voice': 'Voce',
        'tts.speed': 'VelocitÃ :',
        'tts.streaming': 'ModalitÃ  streaming (Consigliata)',
        'tts.generate': 'Genera voce',
        'tts.download': 'Scarica audio',
        'status.complete': 'Generazione completata',
        'status.processing': 'Elaborazione in corso...',
        'stt.upload': 'Trascina i file audio qui o clicca per caricare',
        'stt.formats': 'Supporta WAV, MP3, FLAC, M4A',
        'stt.settings': 'ğŸ¯ Impostazioni trascrizione',
        'stt.model': 'Modello Whisper',
        'stt.model.turbo': 'Turbo (Consigliato)',
        'stt.language': 'Lingua',
        'stt.language.auto': 'Rilevamento automatico',
        'stt.prompt': 'Prompt',
        'stt.prompt.placeholder': 'Inserisci termini tecnici, nomi, luoghi, ecc.',
        'stt.prompt.hint': 'ğŸ’¡ Includere punteggiatura + termini tecnici + nomi puÃ² migliorare significativamente la precisione. Personalizza in base allo scenario',
        'stt.format': 'Formato output',
        'stt.format.text': 'Testo semplice',
        'stt.format.json': 'JSON (Dettagliato)',
        'stt.format.srt': 'Sottotitoli SRT',
        'stt.format.vtt': 'Sottotitoli VTT',
        'stt.transcribe': 'Inizia trascrizione',
        'blend.language': 'Lingua',
        'blend.voice1': 'Voce 1',
        'blend.weight1': 'Peso 1:',
        'blend.voice2': 'Voce 2',
        'blend.weight2': 'Peso 2:',
        'blend.test': 'Testo di prova',
        'blend.test.placeholder': 'Inserisci testo di prova',
        'blend.generate': 'Miscela e testa'
    },
    'ru': {
        subtitle: 'Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ€ĞµÑ‡Ğ¸ Ğ½Ğ° Apple Silicon',
        'metric.ttfb': 'Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ±Ğ°Ğ¹Ñ‚Ğ°',
        'metric.start': 'Ğ’Ñ€ĞµĞ¼Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ',
        'metric.total': 'ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸',
        'metric.size': 'Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'ĞŸĞ°Ğ¼ÑÑ‚ÑŒ:',
        'model.manage': 'Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ',
        'mode.tts': 'ğŸ“ Ğ¢ĞµĞºÑÑ‚ Ğ² Ñ€ĞµÑ‡ÑŒ',
        'mode.stt': 'ğŸ¤ Ğ ĞµÑ‡ÑŒ Ğ² Ñ‚ĞµĞºÑÑ‚',
        'mode.blend': 'ğŸ¨ Ğ¡Ğ¼ĞµÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²',
        'tts.settings': 'ğŸ¯ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸',
        'tts.model': 'ĞœĞ¾Ğ´ĞµĞ»ÑŒ TTS',
        'tts.model.kokoro': 'Kokoro-82M (Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (ĞšĞ²Ğ°Ğ½Ñ‚Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ)',
        'tts.model.hint': 'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ 9 ÑĞ·Ñ‹ĞºĞ¾Ğ² Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¹, Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹, ÑĞ¿Ğ¾Ğ½ÑĞºĞ¸Ğ¹ Ñ 54 Ğ³Ğ¾Ğ»Ğ¾ÑĞ°Ğ¼Ğ¸',
        'tts.text': 'Ğ’Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ‚ĞµĞºÑÑ‚',
        'tts.text.placeholder': 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ...',
        'tts.language': 'Ğ¯Ğ·Ñ‹Ğº',
        'tts.voice': 'Ğ“Ğ¾Ğ»Ğ¾Ñ',
        'tts.speed': 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ:',
        'tts.streaming': 'ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ (Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)',
        'tts.generate': 'Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµÑ‡ÑŒ',
        'tts.download': 'Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ°ÑƒĞ´Ğ¸Ğ¾',
        'status.complete': 'Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°',
        'status.processing': 'ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°...',
        'stt.upload': 'ĞŸĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ Ğ°ÑƒĞ´Ğ¸Ğ¾Ñ„Ğ°Ğ¹Ğ»Ñ‹ ÑÑĞ´Ğ° Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸',
        'stt.formats': 'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ WAV, MP3, FLAC, M4A',
        'stt.settings': 'ğŸ¯ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ†Ğ¸Ğ¸',
        'stt.model': 'ĞœĞ¾Ğ´ĞµĞ»ÑŒ Whisper',
        'stt.model.turbo': 'Turbo (Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)',
        'stt.language': 'Ğ¯Ğ·Ñ‹Ğº',
        'stt.language.auto': 'ĞĞ²Ñ‚Ğ¾Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ',
        'stt.prompt': 'ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°',
        'stt.prompt.placeholder': 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ñ‹, Ğ¸Ğ¼ĞµĞ½Ğ°, Ğ¼ĞµÑÑ‚Ğ° Ğ¸ Ñ‚.Ğ´.',
        'stt.prompt.hint': 'ğŸ’¡ Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒĞ½ĞºÑ‚ÑƒĞ°Ñ†Ğ¸Ğ¸ + Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¾Ğ² + Ğ¸Ğ¼ĞµĞ½ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑĞ¸Ñ‚ÑŒ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ',
        'stt.format': 'Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°',
        'stt.format.text': 'ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚',
        'stt.format.json': 'JSON (ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾)',
        'stt.format.srt': 'Ğ¡ÑƒĞ±Ñ‚Ğ¸Ñ‚Ñ€Ñ‹ SRT',
        'stt.format.vtt': 'Ğ¡ÑƒĞ±Ñ‚Ğ¸Ñ‚Ñ€Ñ‹ VTT',
        'stt.transcribe': 'ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ†Ğ¸Ñ',
        'blend.language': 'Ğ¯Ğ·Ñ‹Ğº',
        'blend.voice1': 'Ğ“Ğ¾Ğ»Ğ¾Ñ 1',
        'blend.weight1': 'Ğ’ĞµÑ 1:',
        'blend.voice2': 'Ğ“Ğ¾Ğ»Ğ¾Ñ 2',
        'blend.weight2': 'Ğ’ĞµÑ 2:',
        'blend.test': 'Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚',
        'blend.test.placeholder': 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚',
        'blend.generate': 'Ğ¡Ğ¼ĞµÑˆĞ°Ñ‚ÑŒ Ğ¸ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ'
    },
    'th': {
        subtitle: 'à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¹€à¸ªà¸µà¸¢à¸‡à¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸à¸ªà¸¹à¸‡à¸šà¸™ Apple Silicon',
        'metric.ttfb': 'à¸„à¸§à¸²à¸¡à¸¥à¹ˆà¸²à¸Šà¹‰à¸²à¹„à¸šà¸•à¹Œà¹à¸£à¸',
        'metric.start': 'à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸¥à¹ˆà¸™',
        'metric.total': 'à¹€à¸§à¸¥à¸²à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”',
        'metric.size': 'à¸‚à¸™à¸²à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'à¸«à¸™à¹ˆà¸§à¸¢à¸„à¸§à¸²à¸¡à¸ˆà¸³:',
        'model.manage': 'à¸ˆà¸±à¸”à¸à¸²à¸£',
        'mode.tts': 'ğŸ“ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹€à¸›à¹‡à¸™à¹€à¸ªà¸µà¸¢à¸‡',
        'mode.stt': 'ğŸ¤ à¹€à¸ªà¸µà¸¢à¸‡à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡',
        'mode.blend': 'ğŸ¨ à¸œà¸ªà¸¡à¹€à¸ªà¸µà¸¢à¸‡',
        'tts.settings': 'ğŸ¯ à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡',
        'tts.model': 'à¹‚à¸¡à¹€à¸”à¸¥ TTS',
        'tts.model.kokoro': 'Kokoro-82M (à¹à¸™à¸°à¸™à¸³)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™à¸šà¸µà¸šà¸­à¸±à¸”)',
        'tts.model.hint': 'à¸£à¸­à¸‡à¸£à¸±à¸š 9 à¸ à¸²à¸©à¸²à¸£à¸§à¸¡à¸–à¸¶à¸‡à¸ˆà¸µà¸™ à¸­à¸±à¸‡à¸à¸¤à¸© à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™ à¸”à¹‰à¸§à¸¢ 54 à¹€à¸ªà¸µà¸¢à¸‡',
        'tts.text': 'à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸›à¹‰à¸­à¸™à¹€à¸‚à¹‰à¸²',
        'tts.text.placeholder': 'à¸›à¹‰à¸­à¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸ˆà¸°à¹à¸›à¸¥à¸‡...',
        'tts.language': 'à¸ à¸²à¸©à¸²',
        'tts.voice': 'à¹€à¸ªà¸µà¸¢à¸‡',
        'tts.speed': 'à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§:',
        'tts.streaming': 'à¹‚à¸«à¸¡à¸”à¸ªà¸•à¸£à¸µà¸¡à¸¡à¸´à¹ˆà¸‡ (à¹à¸™à¸°à¸™à¸³)',
        'tts.generate': 'à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸ªà¸µà¸¢à¸‡',
        'tts.download': 'à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹€à¸ªà¸µà¸¢à¸‡',
        'status.complete': 'à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™',
        'status.processing': 'à¸à¸³à¸¥à¸±à¸‡à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥...',
        'stt.upload': 'à¸¥à¸²à¸à¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡à¸¡à¸²à¸—à¸µà¹ˆà¸™à¸µà¹ˆà¸«à¸£à¸·à¸­à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”',
        'stt.formats': 'à¸£à¸­à¸‡à¸£à¸±à¸š WAV, MP3, FLAC, M4A',
        'stt.settings': 'ğŸ¯ à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸à¸²à¸£à¸–à¸­à¸”à¹€à¸ªà¸µà¸¢à¸‡',
        'stt.model': 'à¹‚à¸¡à¹€à¸”à¸¥ Whisper',
        'stt.model.turbo': 'Turbo (à¹à¸™à¸°à¸™à¸³)',
        'stt.language': 'à¸ à¸²à¸©à¸²',
        'stt.language.auto': 'à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´',
        'stt.prompt': 'à¸à¸£à¸­à¸¡à¸•à¹Œ',
        'stt.prompt.placeholder': 'à¸›à¹‰à¸­à¸™à¸¨à¸±à¸à¸—à¹Œà¹€à¸—à¸„à¸™à¸´à¸„ à¸Šà¸·à¹ˆà¸­ à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ à¸¯à¸¥à¸¯',
        'stt.prompt.hint': 'ğŸ’¡ à¸à¸²à¸£à¸£à¸§à¸¡à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢à¸§à¸£à¸£à¸„à¸•à¸­à¸™ + à¸¨à¸±à¸à¸—à¹Œà¹€à¸—à¸„à¸™à¸´à¸„ + à¸Šà¸·à¹ˆà¸­ à¸ªà¸²à¸¡à¸²à¸£à¸–à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¸„à¸§à¸²à¸¡à¹à¸¡à¹ˆà¸™à¸¢à¸³à¹„à¸”à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¸¡à¸²à¸ à¸›à¸£à¸±à¸šà¹à¸•à¹ˆà¸‡à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸à¸²à¸£à¸“à¹Œ',
        'stt.format': 'à¸£à¸¹à¸›à¹à¸šà¸šà¹€à¸­à¸²à¸•à¹Œà¸à¸¸à¸•',
        'stt.format.text': 'à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸˜à¸£à¸£à¸¡à¸”à¸²',
        'stt.format.json': 'JSON (à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”)',
        'stt.format.srt': 'à¸‹à¸±à¸šà¹„à¸•à¹€à¸•à¸´à¸¥ SRT',
        'stt.format.vtt': 'à¸‹à¸±à¸šà¹„à¸•à¹€à¸•à¸´à¸¥ VTT',
        'stt.transcribe': 'à¹€à¸£à¸´à¹ˆà¸¡à¸–à¸­à¸”à¹€à¸ªà¸µà¸¢à¸‡',
        'blend.language': 'à¸ à¸²à¸©à¸²',
        'blend.voice1': 'à¹€à¸ªà¸µà¸¢à¸‡ 1',
        'blend.weight1': 'à¸™à¹‰à¸³à¸«à¸™à¸±à¸ 1:',
        'blend.voice2': 'à¹€à¸ªà¸µà¸¢à¸‡ 2',
        'blend.weight2': 'à¸™à¹‰à¸³à¸«à¸™à¸±à¸ 2:',
        'blend.test': 'à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸”à¸ªà¸­à¸š',
        'blend.test.placeholder': 'à¸›à¹‰à¸­à¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸”à¸ªà¸­à¸š',
        'blend.generate': 'à¸œà¸ªà¸¡à¹à¸¥à¸°à¸—à¸”à¸ªà¸­à¸š'
    },
    'ar': {
        subtitle: 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¹Ù„Ù‰ Apple Silicon',
        'metric.ttfb': 'Ø²Ù…Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¨Ø§ÙŠØª Ø§Ù„Ø£ÙˆÙ„',
        'metric.start': 'ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„',
        'metric.total': 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
        'metric.size': 'Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'Ø§Ù„Ø°Ø§ÙƒØ±Ø©:',
        'model.manage': 'Ø¥Ø¯Ø§Ø±Ø©',
        'mode.tts': 'ğŸ“ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…',
        'mode.stt': 'ğŸ¤ Ø§Ù„ÙƒÙ„Ø§Ù… Ø¥Ù„Ù‰ Ù†Øµ',
        'mode.blend': 'ğŸ¨ Ù…Ø²Ø¬ Ø§Ù„Ø£ØµÙˆØ§Øª',
        'tts.settings': 'ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙˆÙ„ÙŠØ¯',
        'tts.model': 'Ù†Ù…ÙˆØ°Ø¬ TTS',
        'tts.model.kokoro': 'Kokoro-82M (Ù…ÙˆØµÙ‰ Ø¨Ù‡)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (Ù…Ø¶ØºÙˆØ·)',
        'tts.model.hint': 'ÙŠØ¯Ø¹Ù… 9 Ù„ØºØ§Øª Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„ØµÙŠÙ†ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ© Ù…Ø¹ 54 ØµÙˆØª',
        'tts.text': 'Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„',
        'tts.text.placeholder': 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ù„Ù„ØªØ­ÙˆÙŠÙ„...',
        'tts.language': 'Ø§Ù„Ù„ØºØ©',
        'tts.voice': 'Ø§Ù„ØµÙˆØª',
        'tts.speed': 'Ø§Ù„Ø³Ø±Ø¹Ø©:',
        'tts.streaming': 'ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø« (Ù…ÙˆØµÙ‰ Ø¨Ù‡)',
        'tts.generate': 'ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙ„Ø§Ù…',
        'tts.download': 'ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª',
        'status.complete': 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªÙˆÙ„ÙŠØ¯',
        'status.processing': 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...',
        'stt.upload': 'Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØªÙŠØ© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø±ÙØ¹',
        'stt.formats': 'ÙŠØ¯Ø¹Ù… WAV, MP3, FLAC, M4A',
        'stt.settings': 'ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø®',
        'stt.model': 'Ù†Ù…ÙˆØ°Ø¬ Whisper',
        'stt.model.turbo': 'Turbo (Ù…ÙˆØµÙ‰ Ø¨Ù‡)',
        'stt.language': 'Ø§Ù„Ù„ØºØ©',
        'stt.language.auto': 'ÙƒØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ',
        'stt.prompt': 'Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø©',
        'stt.prompt.placeholder': 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„Ø£Ù…Ø§ÙƒÙ† Ø¥Ù„Ø®',
        'stt.prompt.hint': 'ğŸ’¡ ØªØ¶Ù…ÙŠÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ… + Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© + Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØ­Ø³Ù† Ø§Ù„Ø¯Ù‚Ø© Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±. Ø®ØµØµ Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ',
        'stt.format': 'ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬',
        'stt.format.text': 'Ù†Øµ Ø¹Ø§Ø¯ÙŠ',
        'stt.format.json': 'JSON (Ù…ÙØµÙ„)',
        'stt.format.srt': 'ØªØ±Ø¬Ù…Ø§Øª SRT',
        'stt.format.vtt': 'ØªØ±Ø¬Ù…Ø§Øª VTT',
        'stt.transcribe': 'Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø³Ø®',
        'blend.language': 'Ø§Ù„Ù„ØºØ©',
        'blend.voice1': 'Ø§Ù„ØµÙˆØª 1',
        'blend.weight1': 'Ø§Ù„ÙˆØ²Ù† 1:',
        'blend.voice2': 'Ø§Ù„ØµÙˆØª 2',
        'blend.weight2': 'Ø§Ù„ÙˆØ²Ù† 2:',
        'blend.test': 'Ù†Øµ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',
        'blend.test.placeholder': 'Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',
        'blend.generate': 'Ù…Ø²Ø¬ ÙˆØ§Ø®ØªØ¨Ø§Ø±'
    },
    'hi': {
        subtitle: 'Apple Silicon à¤ªà¤° à¤‰à¤šà¥à¤š-à¤ªà¥à¤°à¤¦à¤°à¥à¤¶à¤¨ à¤µà¤¾à¤•à¥ à¤ªà¥à¤°à¤¸à¤‚à¤¸à¥à¤•à¤°à¤£',
        'metric.ttfb': 'à¤ªà¤¹à¤²à¥€ à¤¬à¤¾à¤‡à¤Ÿ à¤µà¤¿à¤²à¤‚à¤¬à¤¤à¤¾',
        'metric.start': 'à¤ªà¥à¤²à¥‡à¤¬à¥ˆà¤• à¤ªà¥à¤°à¤¾à¤°à¤‚à¤­ à¤¸à¤®à¤¯',
        'metric.total': 'à¤•à¥à¤² à¤ªà¥à¤°à¤¸à¤‚à¤¸à¥à¤•à¤°à¤£ à¤¸à¤®à¤¯',
        'metric.size': 'à¤¡à¥‡à¤Ÿà¤¾ à¤†à¤•à¤¾à¤°',
        'model.tts': 'TTS:',
        'model.stt': 'STT:',
        'model.memory': 'à¤®à¥‡à¤®à¥‹à¤°à¥€:',
        'model.manage': 'à¤ªà¥à¤°à¤¬à¤‚à¤§à¤¨',
        'mode.tts': 'ğŸ“ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤Ÿà¥‚ à¤¸à¥à¤ªà¥€à¤š',
        'mode.stt': 'ğŸ¤ à¤¸à¥à¤ªà¥€à¤š à¤Ÿà¥‚ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ',
        'mode.blend': 'ğŸ¨ à¤†à¤µà¤¾à¤œà¤¼ à¤®à¤¿à¤¶à¥à¤°à¤£',
        'tts.settings': 'ğŸ¯ à¤œà¥‡à¤¨à¤°à¥‡à¤¶à¤¨ à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸',
        'tts.model': 'TTS à¤®à¥‰à¤¡à¤²',
        'tts.model.kokoro': 'Kokoro-82M (à¤…à¤¨à¥à¤¶à¤‚à¤¸à¤¿à¤¤)',
        'tts.model.kokoro4bit': 'Kokoro-82M-4bit (à¤•à¥à¤µà¤¾à¤‚à¤Ÿà¤¾à¤‡à¤œà¤¼à¥à¤¡)',
        'tts.model.hint': 'à¤šà¥€à¤¨à¥€, à¤…à¤‚à¤—à¥à¤°à¥‡à¤œà¥€, à¤œà¤¾à¤ªà¤¾à¤¨à¥€ à¤¸à¤¹à¤¿à¤¤ 9 à¤­à¤¾à¤·à¤¾à¤“à¤‚ à¤•à¤¾ à¤¸à¤®à¤°à¥à¤¥à¤¨ 54 à¤†à¤µà¤¾à¤œà¤¼à¥‹à¤‚ à¤•à¥‡ à¤¸à¤¾à¤¥',
        'tts.text': 'à¤‡à¤¨à¤ªà¥à¤Ÿ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ',
        'tts.text.placeholder': 'à¤•à¤¨à¥à¤µà¤°à¥à¤Ÿ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚...',
        'tts.language': 'à¤­à¤¾à¤·à¤¾',
        'tts.voice': 'à¤†à¤µà¤¾à¤œà¤¼',
        'tts.speed': 'à¤—à¤¤à¤¿:',
        'tts.streaming': 'à¤¸à¥à¤Ÿà¥à¤°à¥€à¤®à¤¿à¤‚à¤— à¤®à¥‹à¤¡ (à¤…à¤¨à¥à¤¶à¤‚à¤¸à¤¿à¤¤)',
        'tts.generate': 'à¤¸à¥à¤ªà¥€à¤š à¤œà¥‡à¤¨à¤°à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚',
        'tts.download': 'à¤‘à¤¡à¤¿à¤¯à¥‹ à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚',
        'status.complete': 'à¤œà¥‡à¤¨à¤°à¥‡à¤¶à¤¨ à¤ªà¥‚à¤°à¥à¤£',
        'status.processing': 'à¤ªà¥à¤°à¤¸à¤‚à¤¸à¥à¤•à¤°à¤£...',
        'stt.upload': 'à¤‘à¤¡à¤¿à¤¯à¥‹ à¤«à¤¾à¤‡à¤²à¥‡à¤‚ à¤¯à¤¹à¤¾à¤ à¤–à¥€à¤‚à¤šà¥‡à¤‚ à¤¯à¤¾ à¤…à¤ªà¤²à¥‹à¤¡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚',
        'stt.formats': 'WAV, MP3, FLAC, M4A à¤¸à¤®à¤°à¥à¤¥à¤¿à¤¤',
        'stt.settings': 'ğŸ¯ à¤Ÿà¥à¤°à¤¾à¤‚à¤¸à¤•à¥à¤°à¤¿à¤ªà¥à¤¶à¤¨ à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸',
        'stt.model': 'Whisper à¤®à¥‰à¤¡à¤²',
        'stt.model.turbo': 'Turbo (à¤…à¤¨à¥à¤¶à¤‚à¤¸à¤¿à¤¤)',
        'stt.language': 'à¤­à¤¾à¤·à¤¾',
        'stt.language.auto': 'à¤¸à¥à¤µà¤šà¤¾à¤²à¤¿à¤¤ à¤ªà¤¹à¤šà¤¾à¤¨',
        'stt.prompt': 'à¤ªà¥à¤°à¥‰à¤®à¥à¤ªà¥à¤Ÿ',
        'stt.prompt.placeholder': 'à¤¤à¤•à¤¨à¥€à¤•à¥€ à¤¶à¤¬à¥à¤¦, à¤¨à¤¾à¤®, à¤¸à¥à¤¥à¤¾à¤¨ à¤†à¤¦à¤¿ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚',
        'stt.prompt.hint': 'ğŸ’¡ à¤µà¤¿à¤°à¤¾à¤® à¤šà¤¿à¤¹à¥à¤¨ + à¤¤à¤•à¤¨à¥€à¤•à¥€ à¤¶à¤¬à¥à¤¦ + à¤¨à¤¾à¤® à¤¶à¤¾à¤®à¤¿à¤² à¤•à¤°à¤¨à¥‡ à¤¸à¥‡ à¤¸à¤Ÿà¥€à¤•à¤¤à¤¾ à¤®à¥‡à¤‚ à¤•à¤¾à¤«à¥€ à¤¸à¥à¤§à¤¾à¤° à¤¹à¥‹ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤ªà¤°à¤¿à¤¦à¥ƒà¤¶à¥à¤¯ à¤•à¥‡ à¤…à¤¨à¥à¤¸à¤¾à¤° à¤…à¤¨à¥à¤•à¥‚à¤²à¤¿à¤¤ à¤•à¤°à¥‡à¤‚',
        'stt.format': 'à¤†à¤‰à¤Ÿà¤ªà¥à¤Ÿ à¤«à¥‰à¤°à¥à¤®à¥‡à¤Ÿ',
        'stt.format.text': 'à¤¸à¤¾à¤¦à¤¾ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ',
        'stt.format.json': 'JSON (à¤µà¤¿à¤¸à¥à¤¤à¥ƒà¤¤)',
        'stt.format.srt': 'SRT à¤¸à¤¬à¤Ÿà¤¾à¤‡à¤Ÿà¤²',
        'stt.format.vtt': 'VTT à¤¸à¤¬à¤Ÿà¤¾à¤‡à¤Ÿà¤²',
        'stt.transcribe': 'à¤Ÿà¥à¤°à¤¾à¤‚à¤¸à¤•à¥à¤°à¤¿à¤ªà¥à¤¶à¤¨ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚',
        'blend.language': 'à¤­à¤¾à¤·à¤¾',
        'blend.voice1': 'à¤†à¤µà¤¾à¤œà¤¼ 1',
        'blend.weight1': 'à¤µà¥‡à¤Ÿ 1:',
        'blend.voice2': 'à¤†à¤µà¤¾à¤œà¤¼ 2',
        'blend.weight2': 'à¤µà¥‡à¤Ÿ 2:',
        'blend.test': 'à¤Ÿà¥‡à¤¸à¥à¤Ÿ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ',
        'blend.test.placeholder': 'à¤Ÿà¥‡à¤¸à¥à¤Ÿ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚',
        'blend.generate': 'à¤®à¤¿à¤¶à¥à¤°à¤£ à¤”à¤° à¤ªà¤°à¥€à¤•à¥à¤·à¤£'
    }
};

// i18n Functions
let currentLanguage = 'zh-CN';

function setLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('mlx-audio-language', lang);
    document.getElementById('language-selector').value = lang;
    applyTranslations();
    updateVoices();  // åˆ‡æ¢è¯­è¨€åé‡æ–°å¡«å……å£°éŸ³åˆ—è¡¨
}

function applyTranslations() {
    const translations = i18n[currentLanguage] || i18n['zh-CN'];
    
    // Apply translations to elements with data-i18n attributes
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[key]) {
            element.textContent = translations[key];
        }
    });
    
    // Apply placeholder translations
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[key]) {
            element.placeholder = translations[key];
        }
    });
}

function initializeLanguage() {
    const savedLang = localStorage.getItem('mlx-audio-language') || 'en';  // é»˜è®¤è‹±æ–‡
    setLanguage(savedLang);
}

class StreamPlayer {
    constructor() {
        this.audioContext = null;
        this.nextPlayTime = 0;
        this.samples = [];
        this.isFirstChunk = true;
        this.allPcmData = [];
        this.sampleRate = 24000;
        this.allSamples = [];
    }

    drawFullWaveform() {
        const canvas = document.getElementById('waveform');
        if (!canvas || this.allSamples.length === 0) return;
        canvas.classList.remove('hidden');
        
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        
        // æ¸…ç©º
        ctx.fillStyle = '#1a1a24';
        ctx.fillRect(0, 0, width, height);
        
        // ä¸‹é‡‡æ ·
        const step = Math.ceil(this.allSamples.length / width);
        
        ctx.strokeStyle = '#ec4899';
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        for (let i = 0; i < width; i++) {
            const start = i * step;
            const end = Math.min(start + step, this.allSamples.length);
            let max = 0;
            for (let j = start; j < end; j++) {
                max = Math.max(max, Math.abs(this.allSamples[j]));
            }
            
            const x = i;
            const y = height / 2 - (max * height / 2);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();
        
        // é•œåƒ
        ctx.beginPath();
        for (let i = 0; i < width; i++) {
            const start = i * step;
            const end = Math.min(start + step, this.allSamples.length);
            let max = 0;
            for (let j = start; j < end; j++) {
                max = Math.max(max, Math.abs(this.allSamples[j]));
            }
            const x = i;
            const y = height / 2 + (max * height / 2);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();
    }

    startDynamicWaveform() {
        const canvas = document.getElementById('waveform');
        if (!canvas) return;
        canvas.classList.remove('hidden');
        
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        const bufferLength = this.analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        
        const draw = () => {
            requestAnimationFrame(draw);
            this.analyser.getByteFrequencyData(dataArray);
            
            // æ¸å˜èƒŒæ™¯
            const bgGradient = ctx.createLinearGradient(0, 0, 0, height);
            bgGradient.addColorStop(0, '#1a1a24');
            bgGradient.addColorStop(1, '#0a0a0f');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, width, height);
            
            const barWidth = (width / bufferLength) * 2.5;
            let x = 0;
            
            for (let i = 0; i < bufferLength; i++) {
                const barHeight = (dataArray[i] / 255) * height * 0.8;
                
                // å½©è‰²æ¸å˜æ¡
                const barGradient = ctx.createLinearGradient(0, height - barHeight, 0, height);
                barGradient.addColorStop(0, '#ec4899');
                barGradient.addColorStop(0.5, '#8b5cf6');
                barGradient.addColorStop(1, '#3b82f6');
                
                ctx.fillStyle = barGradient;
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#ec4899';
                ctx.fillRect(x, height - barHeight, barWidth, barHeight);
                
                x += barWidth + 1;
            }
            
            ctx.shadowBlur = 0;
        };
        
        draw();
    }

    async streamTTS(url, data) {
        const startTime = performance.now();
        let firstByteTime = null;
        let firstPlayTime = null;
        let totalSize = 0;
        
        // é‡ç½®çŠ¶æ€
        this.allSamples = [];
        this.samples = [];
        this.isFirstChunk = true;
        this.allPcmData = [];

        try {
            updateMetrics('processing');
            
            // ä½¿ç”¨æµå¼ç«¯ç‚¹
            const response = await fetch(API_BASE + '/v1/audio/speech/stream', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });

            if (!response.ok) throw new Error(`HTTP ${response.status}`);

            this.audioContext = new (window.AudioContext || window.webkitAudioContext)({sampleRate: this.sampleRate});
            if (this.audioContext.state === 'suspended') await this.audioContext.resume();
            this.nextPlayTime = this.audioContext.currentTime + 0.1;
            
            // åˆ›å»ºåˆ†æå™¨ç”¨äºåŠ¨æ€æ³¢å½¢
            this.analyser = this.audioContext.createAnalyser();
            this.analyser.fftSize = 2048;
            this.analyser.connect(this.audioContext.destination);
            
            // å¯åŠ¨åŠ¨æ€æ³¢å½¢
            this.startDynamicWaveform();

            const reader = response.body.getReader();
            let pendingBytes = new Uint8Array();
            
            while (true) {
                const {done, value} = await reader.read();
                
                if (done) {
                    this.playBuffer();
                    break;
                }

                if (!firstByteTime) {
                    firstByteTime = performance.now();
                    updateMetric('ttfb', firstByteTime - startTime);
                }

                totalSize += value.length;
                this.allPcmData.push(new Uint8Array(value));
                
                // å®æ—¶æ›´æ–°æ•°æ®å¤§å°å’Œå¤„ç†æ—¶é—´
                updateMetric('size', totalSize / 1024);
                updateMetric('total', performance.now() - startTime);
                
                // åˆå¹¶å­—èŠ‚
                const combined = new Uint8Array(pendingBytes.length + value.length);
                combined.set(pendingBytes);
                combined.set(value, pendingBytes.length);
                
                // å­—èŠ‚å¯¹é½ï¼ˆInt16 = 2 bytesï¼‰
                const validLength = Math.floor(combined.length / 2) * 2;
                const validData = combined.slice(0, validLength);
                pendingBytes = combined.slice(validLength);
                
                // PCM Int16 â†’ Float32
                const alignedBuffer = new ArrayBuffer(validData.length);
                new Uint8Array(alignedBuffer).set(validData);
                const int16Array = new Int16Array(alignedBuffer);
                
                for (let i = 0; i < int16Array.length; i++) {
                    const sample = int16Array[i] / 32768;
                    this.samples.push(sample);
                    this.allSamples.push(sample);
                }
                
                // ç´¯ç§¯æ›´å°‘æ•°æ®å°±å¼€å§‹æ’­æ”¾ï¼ˆ250msè€Œé500msï¼‰
                if (this.samples.length >= 6000 && !firstPlayTime) {
                    firstPlayTime = performance.now();
                    updateMetric('start', firstPlayTime - startTime);
                }
                
                if (this.samples.length >= 6000) {
                    this.playBuffer();
                }
            }

            this.playBuffer();
            const totalTime = performance.now() - startTime;
            updateMetric('total', totalTime);
            updateMetric('size', totalSize / 1024);
            updateMetrics('success');

        } catch (error) {
            updateMetrics('error');
            throw error;
        }
    }

    playBuffer() {
        if (this.samples.length === 0) return;
        
        const maxSamples = 48000;
        while (this.samples.length > 0) {
            const chunkSize = Math.min(this.samples.length, maxSamples);
            const chunk = this.samples.splice(0, chunkSize);
            
            const float32Array = new Float32Array(chunk);
            
            // é¦–å—æ·¡å…¥
            if (this.isFirstChunk) {
                const fadeLen = Math.min(1024, float32Array.length);
                for (let i = 0; i < fadeLen; i++) {
                    float32Array[i] *= i / fadeLen;
                }
                this.isFirstChunk = false;
            }
            
            const audioBuffer = this.audioContext.createBuffer(1, float32Array.length, this.sampleRate);
            audioBuffer.getChannelData(0).set(float32Array);
            
            const source = this.audioContext.createBufferSource();
            source.buffer = audioBuffer;
            source.connect(this.analyser);
            
            // é˜²æ­¢buffer underrun
            if (this.nextPlayTime < this.audioContext.currentTime - 0.1) {
                this.nextPlayTime = this.audioContext.currentTime + 0.05;
            }
            
            source.start(this.nextPlayTime);
            this.nextPlayTime += audioBuffer.duration;
            
            // ç»˜åˆ¶æ³¢å½¢
            this.drawWaveform(float32Array);
        }
    }
    
    drawWaveform(audioData) {
        const canvas = document.getElementById('waveform');
        if (!canvas) return;
        canvas.classList.remove('hidden');
        
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        
        // ä¸‹é‡‡æ ·
        const step = Math.ceil(audioData.length / width);
        const samples = [];
        for (let i = 0; i < width; i++) {
            const start = i * step;
            const end = Math.min(start + step, audioData.length);
            let max = 0;
            for (let j = start; j < end; j++) {
                max = Math.max(max, Math.abs(audioData[j]));
            }
            samples.push(max);
        }
        
        // ç»˜åˆ¶
        ctx.fillStyle = '#1a1a24';
        ctx.fillRect(0, 0, width, height);
        ctx.strokeStyle = '#ec4899';
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        for (let i = 0; i < samples.length; i++) {
            const x = i;
            const y = height / 2 - (samples[i] * height / 2);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();
        
        // é•œåƒä¸‹åŠéƒ¨åˆ†
        ctx.beginPath();
        for (let i = 0; i < samples.length; i++) {
            const x = i;
            const y = height / 2 + (samples[i] * height / 2);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();
    }
}

const VOICES = {
    a: [
        {v:'af_heart',n:'Heart â™€'},{v:'af_nova',n:'Nova â™€'},{v:'af_bella',n:'Bella â™€'},
        {v:'af_alloy',n:'Alloy â™€'},{v:'af_aoede',n:'Aoede â™€'},{v:'af_jessica',n:'Jessica â™€'},
        {v:'af_kore',n:'Kore â™€'},{v:'af_nicole',n:'Nicole â™€'},{v:'af_river',n:'River â™€'},
        {v:'af_sarah',n:'Sarah â™€'},{v:'af_sky',n:'Sky â™€'},
        {v:'am_adam',n:'Adam â™‚'},{v:'am_michael',n:'Michael â™‚'},{v:'am_echo',n:'Echo â™‚'},
        {v:'am_eric',n:'Eric â™‚'},{v:'am_fenrir',n:'Fenrir â™‚'},{v:'am_liam',n:'Liam â™‚'},
        {v:'am_onyx',n:'Onyx â™‚'},{v:'am_puck',n:'Puck â™‚'},{v:'am_santa',n:'Santa â™‚'}
    ],
    b: [
        {v:'bf_emma',n:'Emma â™€'},{v:'bf_isabella',n:'Isabella â™€'},{v:'bf_alice',n:'Alice â™€'},
        {v:'bf_lily',n:'Lily â™€'},{v:'bm_george',n:'George â™‚'},{v:'bm_lewis',n:'Lewis â™‚'},
        {v:'bm_daniel',n:'Daniel â™‚'},{v:'bm_fable',n:'Fable â™‚'}
    ],
    z: [
        {v:'zf_xiaobei',n:'å°è´ â™€'},{v:'zf_xiaoni',n:'å°å¦® â™€'},{v:'zf_xiaoxiao',n:'å°å° â™€'},
        {v:'zf_xiaoyi',n:'å°è‰º â™€'},{v:'zm_yunjian',n:'äº‘å¥ â™‚'},{v:'zm_yunxi',n:'äº‘å¸Œ â™‚'},
        {v:'zm_yunxia',n:'äº‘éœ â™‚'},{v:'zm_yunyang',n:'äº‘æ‰¬ â™‚'}
    ],
    j: [
        {v:'jf_alpha',n:'Alpha â™€'},{v:'jf_gongitsune',n:'Gongitsune â™€'},
        {v:'jf_nezumi',n:'Nezumi â™€'},{v:'jf_tebukuro',n:'Tebukuro â™€'},
        {v:'jm_kumo',n:'Kumo â™‚'}
    ],
    e: [{v:'ef_dora',n:'Dora â™€'},{v:'em_alex',n:'Alex â™‚'},{v:'em_santa',n:'Santa â™‚'}],
    f: [{v:'ff_siwis',n:'Siwis â™€'}],
    h: [{v:'hf_alpha',n:'Alpha â™€'},{v:'hf_beta',n:'Beta â™€'},{v:'hm_omega',n:'Omega â™‚'},{v:'hm_psi',n:'Psi â™‚'}],
    i: [{v:'if_sara',n:'Sara â™€'},{v:'im_nicola',n:'Nicola â™‚'}],
    p: [{v:'pf_dora',n:'Dora â™€'},{v:'pm_alex',n:'Alex â™‚'},{v:'pm_santa',n:'Santa â™‚'}]
};

let currentMode = 'tts';
let streamPlayer = new StreamPlayer();

function setMode(mode) {
    currentMode = mode;
    ['tts','stt'].forEach(m => {
        document.getElementById('mode-'+m).classList.toggle('active', m===mode);
        document.getElementById('panel-'+m).classList.toggle('hidden', m!==mode);
    });
    
    // æ ¹æ®æ¨¡å¼æ›´æ–°æŒ‡æ ‡æ ‡ç­¾
    if(mode === 'stt') {
        document.querySelector('#ttfb-card .metric-label').textContent = 'å¤„ç†è€—æ—¶';
        document.querySelector('#start-card .metric-label').textContent = 'éŸ³é¢‘æ—¶é•¿';
        document.querySelector('#start-card .metric-unit').textContent = 's';
        document.querySelector('#total-card .metric-label').textContent = 'å¤„ç†é€Ÿåº¦';
        document.querySelector('#total-card .metric-unit').textContent = '';  // ç§»é™¤mså•ä½
        document.querySelector('#size-card .metric-label').textContent = 'æ–‡ä»¶å¤§å°';
    } else {
        document.querySelector('#ttfb-card .metric-label').textContent = 'é¦–å­—èŠ‚å»¶è¿Ÿ';
        document.querySelector('#start-card .metric-label').textContent = 'å¼€å§‹æ’­æ”¾';
        document.querySelector('#start-card .metric-unit').textContent = 'ms';
        document.querySelector('#total-card .metric-label').textContent = 'æ€»å¤„ç†æ—¶é—´';
        document.querySelector('#size-card .metric-label').textContent = 'æ•°æ®å¤§å°';
    }
    
    resetMetrics();
}

function updateVoices() {
    const lang = document.getElementById('tts-lang').value;
    const sel = document.getElementById('tts-voice');
    sel.innerHTML = VOICES[lang].map(v => `<option value="${v.v}">${v.n}</option>`).join('');
}

function updateBlendVoices() {
    const lang = document.getElementById('blend-lang').value;
    const voices = VOICES[lang] || VOICES['a'];
    const html = voices.map(v => `<option value="${v.v}">${v.n}</option>`).join('');
    document.getElementById('blend-voice1').innerHTML = html;
    document.getElementById('blend-voice2').innerHTML = html;
    if(voices.length > 1) document.getElementById('blend-voice2').selectedIndex = 1;
}

async function blendAndTest() {
    const btn = document.getElementById('blend-btn');
    btn.disabled = true;
    btn.innerHTML = '<span class="loading">â³</span> ' + (i18n[currentLanguage]['blend.blending'] || 'æ··åˆå¹¶ç”Ÿæˆä¸­...');
    resetMetrics();
    
    try {
        updateMetrics('processing');
        
        // 1. å…ˆæ··åˆå£°éŸ³
        const blendRes = await fetch(API_BASE + '/v1/audio/voice/blend', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                voice1: document.getElementById('blend-voice1').value,
                voice2: document.getElementById('blend-voice2').value,
                weight1: parseFloat(document.getElementById('blend-weight1').value),
                weight2: parseFloat(document.getElementById('blend-weight2').value),
                lang_code: document.getElementById('blend-lang').value
            })
        });
        const blendData = await blendRes.json();
        
        // 2. ç”¨æ··åˆå£°éŸ³ç”Ÿæˆï¼ˆæµå¼ï¼‰
        const requestData = {
            model: document.getElementById('tts-model').value,
            input: document.getElementById('blend-text').value,
            voice: document.getElementById('blend-voice1').value,
            lang_code: document.getElementById('blend-lang').value,
            blended_voice: blendData.blended_voice
        };
        
        await streamPlayer.streamTTS('/v1/audio/speech/stream', requestData);
        
    } catch(e) { 
        updateMetrics('error');
        console.error(e);
    }
    finally { 
        btn.disabled = false; 
        btn.innerHTML = '<span>ğŸ¨</span> æ··åˆå¹¶æµ‹è¯•'; 
    }
}

function updateSpeed(value) {
    document.getElementById('speed-val').textContent = value;
    document.getElementById('speed-display').textContent = value + 'x';
}

function updateMetric(type, value) {
    const element = document.getElementById(type + '-value');
    if (element) {
        // å¦‚æœæ˜¯å­—ç¬¦ä¸²ç›´æ¥æ˜¾ç¤ºï¼Œå¦åˆ™å››èˆäº”å…¥
        element.textContent = typeof value === 'string' ? value : Math.round(value);
    }
}

function updateMetrics(status) {
    const cards = document.querySelectorAll('.metric-card');
    cards.forEach(card => {
        card.classList.remove('success');
        if (status === 'success') {
            card.classList.add('success');
        }
    });
    
    const indicator = document.getElementById('status-indicator');
    indicator.className = `status-indicator ${status}`;
    const statusText = i18n[currentLanguage]?.[`status.${status}`] || 
                      (status === 'success' ? 'ç”Ÿæˆå®Œæˆ' : status === 'processing' ? 'å¤„ç†ä¸­...' : 'é”™è¯¯');
    indicator.innerHTML = status === 'success' ? '<span>âœ“</span> ' + statusText : 
                        status === 'processing' ? '<span class="pulsing">â³</span> ' + statusText :
                        '<span>âŒ</span> ç”Ÿæˆå¤±è´¥';
    indicator.classList.remove('hidden');
}

function resetMetrics() {
    ['ttfb','start','total','size'].forEach(type => {
        document.getElementById(type + '-value').textContent = '--';
    });
    document.querySelectorAll('.metric-card').forEach(card => card.classList.remove('success'));
    document.getElementById('status-indicator').classList.add('hidden');
}

async function generateTTS() {
    const btn = document.getElementById('tts-btn');
    const audio = document.getElementById('tts-audio');
    const downloadBtn = document.getElementById('download-btn');
    const progressBar = document.getElementById('progress-bar');
    const isStreaming = document.getElementById('streaming-toggle').checked;
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading">â³</span> ' + (i18n[currentLanguage]['tts.generating'] || 'ç”Ÿæˆä¸­...');
    progressBar.classList.remove('hidden');
    resetMetrics();
    
    const startTime = performance.now();
    
    try {
        const requestData = {
            model: document.getElementById('tts-model').value,
            input: document.getElementById('tts-text').value,
            voice: document.getElementById('tts-voice').value,
            speed: parseFloat(document.getElementById('tts-speed').value),
            lang_code: document.getElementById('tts-lang').value
        };

        if (isStreaming) {
            // ä½¿ç”¨æµå¼ç«¯ç‚¹
            await streamPlayer.streamTTS('/v1/audio/speech/stream', requestData);
            downloadBtn.classList.remove('hidden');  // æ˜¾ç¤ºä¸‹è½½æŒ‰é’®
        } else {
            updateMetrics('processing');
            
            const res = await fetch(API_BASE + '/v1/audio/speech', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(requestData)
            });
            
            const firstByteTime = performance.now();
            updateMetric('ttfb', firstByteTime - startTime);
            
            const blob = await res.blob();
            updateMetric('size', blob.size / 1024);
            
            audio.src = URL.createObjectURL(blob);
            audio.classList.remove('hidden');
            downloadBtn.classList.remove('hidden');
            
            const playStartTime = performance.now();
            updateMetric('start', playStartTime - startTime);
            
            await audio.play();
            
            const totalTime = performance.now() - startTime;
            updateMetric('total', totalTime);
            updateMetrics('success');
        }
        
    } catch(e) { 
        updateMetrics('error');
        alert('Error: '+e.message); 
    } finally { 
        btn.disabled = false; 
        const btnText = i18n[currentLanguage]['tts.generate'] || 'ç”Ÿæˆè¯­éŸ³';
        btn.innerHTML = '<span>â–¶</span> ' + btnText;
        progressBar.classList.add('hidden');
    }
}

function downloadAudio() {
    const audio = document.getElementById('tts-audio');
    
    // å¦‚æœæ˜¯æµå¼æ¨¡å¼ï¼Œä»StreamPlayerè·å–WAV
    if(streamPlayer && streamPlayer.allPcmData && streamPlayer.allPcmData.length > 0) {
        // åˆå¹¶PCMæ•°æ®
        const totalLength = streamPlayer.allPcmData.reduce((sum, arr) => sum + arr.length, 0);
        const pcmData = new Uint8Array(totalLength);
        let offset = 0;
        for (const chunk of streamPlayer.allPcmData) {
            pcmData.set(chunk, offset);
            offset += chunk.length;
        }
        
        // è½¬æ¢ä¸ºWAV
        const wavBlob = pcmToWav(pcmData, 24000);
        const url = URL.createObjectURL(wavBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'mlx-audio-' + Date.now() + '.wav';
        a.click();
        URL.revokeObjectURL(url);
    } else if (audio.src) {
        // æ ‡å‡†æ¨¡å¼
        const a = document.createElement('a');
        a.href = audio.src;
        a.download = 'mlx-audio-' + Date.now() + '.wav';
        a.click();
    } else {
        alert('No audio to download');
    }
}

function pcmToWav(pcmData, sampleRate) {
    const numChannels = 1;
    const bitsPerSample = 16;
    const byteRate = sampleRate * numChannels * bitsPerSample / 8;
    const blockAlign = numChannels * bitsPerSample / 8;
    const dataSize = pcmData.length;
    const buffer = new ArrayBuffer(44 + dataSize);
    const view = new DataView(buffer);
    
    const writeString = (offset, str) => {
        for (let i = 0; i < str.length; i++) 
            view.setUint8(offset + i, str.charCodeAt(i));
    };
    
    writeString(0, 'RIFF');
    view.setUint32(4, 36 + dataSize, true);
    writeString(8, 'WAVE');
    writeString(12, 'fmt ');
    view.setUint32(16, 16, true);
    view.setUint16(20, 1, true);
    view.setUint16(22, numChannels, true);
    view.setUint32(24, sampleRate, true);
    view.setUint32(28, byteRate, true);
    view.setUint16(32, blockAlign, true);
    view.setUint16(34, bitsPerSample, true);
    writeString(36, 'data');
    view.setUint32(40, dataSize, true);
    
    new Uint8Array(buffer, 44).set(pcmData);
    return new Blob([buffer], { type: 'audio/wav' });
}

function handleFileSelect(input) {
    if(input.files[0]) {
        document.getElementById('file-name').textContent = 'ğŸ“„ ' + input.files[0].name;
        document.getElementById('file-name').classList.remove('hidden');
    }
}

function updatePromptCount() {
    const prompt = document.getElementById('stt-prompt').value;
    const count = prompt.length;
    const countEl = document.getElementById('prompt-count');
    countEl.textContent = `(${count}/900)`;
    countEl.style.color = count > 900 ? '#ef4444' : 'var(--dim)';
}

async function transcribe() {
    const btn = document.getElementById('stt-btn');
    const file = document.getElementById('stt-file').files[0];
    console.log('Transcribe called, file:', file);
    if(!file) {
        console.error('No file selected');
        alert('è¯·å…ˆé€‰æ‹©éŸ³é¢‘æ–‡ä»¶');
        return;
    }
    
    console.log('Starting transcription...');
    btn.disabled = true;
    btn.innerHTML = '<span class="loading">â³</span> ' + (i18n[currentLanguage]['stt.transcribing'] || 'è½¬å½•ä¸­...');
    resetMetrics();
    updateMetrics('processing');
    
    const progressDiv = document.getElementById('stt-progress');
    const progressBar = document.getElementById('stt-progress-bar');
    const progressText = document.getElementById('stt-progress-text');
    progressDiv.classList.remove('hidden');
    
    const startTime = performance.now();
    let audioDuration = 0;
    let progressInterval = null;
    
    try {
        // è·å–éŸ³é¢‘æ—¶é•¿
        const audioEl = new Audio(URL.createObjectURL(file));
        await new Promise(resolve => {
            audioEl.onloadedmetadata = () => {
                audioDuration = audioEl.duration;
                console.log('Audio duration:', audioDuration);
                updateMetric('start', audioDuration);
                resolve();
            };
        });
        
        const form = new FormData();
        form.append('file', file);
        form.append('model', document.getElementById('stt-model').value);
        
        const lang = document.getElementById('stt-lang').value;
        const prompt = document.getElementById('stt-prompt').value;
        const format = document.getElementById('stt-format').value;
        
        if(lang) form.append('language', lang);
        if(prompt) form.append('prompt', prompt);
        if(format) form.append('format', format);
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦å¼‚æ­¥å¤„ç†ï¼ˆ>5åˆ†é’Ÿï¼‰
        if (audioDuration > 300) {
            console.log('Long audio detected, using async API');
            await transcribeAsync(form, startTime, progressDiv, progressBar, progressText, file);
        } else {
            console.log('Short audio, using sync API');
            await transcribeSync(form, startTime, progressDiv, progressBar, progressText, file, audioDuration);
        }
        
    } catch(e) { 
        console.error('Transcribe error:', e);
        if(progressInterval) clearInterval(progressInterval);
        progressDiv.classList.add('hidden');
        updateMetrics('error');
        alert('è½¬å½•å¤±è´¥: ' + e.message); 
    } finally { 
        btn.disabled = false; 
        btn.innerHTML = '<span>â–¶</span> ' + (i18n[currentLanguage]['stt.transcribe'] || 'å¼€å§‹è½¬å½•'); 
    }
}

async function transcribeSync(form, startTime, progressDiv, progressBar, progressText, file, audioDuration) {
    let progressInterval = setInterval(() => {
        const elapsed = (performance.now() - startTime) / 1000;
        const estimatedTotal = audioDuration * 0.05 + 2;
        const progress = Math.min(95, (elapsed / estimatedTotal) * 100);
        progressBar.style.width = progress + '%';
        progressText.textContent = Math.floor(progress) + '%';
    }, 100);
    
    const uploadStart = performance.now();
    console.log('Sending sync request to:', API_BASE + '/v1/audio/transcriptions');
    
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 7200000);
    
    const res = await fetch(API_BASE + '/v1/audio/transcriptions', {
        method:'POST', 
        body:form,
        signal: controller.signal
    });
    clearTimeout(timeout);
    const processEnd = performance.now();
    
    clearInterval(progressInterval);
    progressBar.style.width = '100%';
    progressText.textContent = '100%';
    
    const totalProcessTime = processEnd - uploadStart;
    updateMetric('ttfb', totalProcessTime);
    
    const data = await res.json();
    displayResult(data, file);
    
    setTimeout(() => progressDiv.classList.add('hidden'), 1000);
    
    const totalTime = processEnd - uploadStart;
    if(audioDuration > 0) {
        const rtf = (totalTime / 1000) / audioDuration;
        const speedMultiplier = (1 / rtf).toFixed(1);
        updateMetric('total', speedMultiplier + 'x');
    } else {
        updateMetric('total', (totalTime / 1000).toFixed(1) + 's');
    }
    updateMetric('size', file.size / 1024);
    updateMetrics('success');
}

async function transcribeAsync(form, startTime, progressDiv, progressBar, progressText, file) {
    // 1. æäº¤å¼‚æ­¥ä»»åŠ¡
    console.log('Submitting async task to:', API_BASE + '/v1/audio/transcriptions/async');
    const submitRes = await fetch(API_BASE + '/v1/audio/transcriptions/async', {
        method: 'POST',
        body: form
    });
    
    if (!submitRes.ok) {
        throw new Error(`æäº¤å¤±è´¥: ${submitRes.status}`);
    }
    
    const submitData = await submitRes.json();
    const taskId = submitData.task_id;
    console.log('Task submitted, ID:', taskId);
    
    // 2. è½®è¯¢çŠ¶æ€
    progressText.textContent = 'å·²æäº¤ï¼Œç­‰å¾…å¤„ç†...';
    let pollCount = 0;
    
    const pollInterval = setInterval(async () => {
        try {
            pollCount++;
            console.log(`Polling attempt ${pollCount} for task ${taskId}`);
            
            const statusRes = await fetch(API_BASE + `/v1/audio/transcriptions/async/${taskId}`);
            if (!statusRes.ok) {
                throw new Error(`çŠ¶æ€æŸ¥è¯¢å¤±è´¥: ${statusRes.status}`);
            }
            
            const statusData = await statusRes.json();
            console.log('Task status:', statusData);
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            const elapsed = (performance.now() - startTime) / 1000;
            const progress = Math.min(90, (elapsed / 60) * 100); // å‡è®¾æœ€å¤š1åˆ†é’Ÿå®Œæˆ
            progressBar.style.width = progress + '%';
            progressText.textContent = `${statusData.status} (${Math.floor(progress)}%)`;
            
            if (statusData.status === 'completed') {
                clearInterval(pollInterval);
                
                // 3. æ˜¾ç¤ºç»“æœ
                progressBar.style.width = '100%';
                progressText.textContent = '100% - å®Œæˆ';
                
                displayResult(statusData.result, file);
                
                setTimeout(() => progressDiv.classList.add('hidden'), 1000);
                
                const totalTime = performance.now() - startTime;
                updateMetric('ttfb', totalTime);
                updateMetric('total', (totalTime / 1000).toFixed(1) + 's');
                updateMetric('size', file.size / 1024);
                updateMetrics('success');
                
            } else if (statusData.status === 'failed') {
                clearInterval(pollInterval);
                throw new Error(statusData.error || 'å¤„ç†å¤±è´¥');
            }
            // å…¶ä»–çŠ¶æ€ï¼ˆpending, processingï¼‰ç»§ç»­è½®è¯¢
            
        } catch (pollError) {
            clearInterval(pollInterval);
            throw pollError;
        }
    }, 2000); // æ¯2ç§’è½®è¯¢ä¸€æ¬¡
}

function displayResult(data, file) {
    const result = document.getElementById('stt-result');
    const format = document.getElementById('stt-format').value;
    
    if(format === 'json') {
        result.textContent = JSON.stringify(data, null, 2);
    } else {
        result.textContent = data.text || data;
    }
    result.classList.remove('hidden');
    
    // æ’­æ”¾ä¸Šä¼ çš„éŸ³é¢‘å¹¶æ˜¾ç¤ºå¯è§†åŒ–
    const sttAudio = document.getElementById('stt-audio');
    if(sttAudio) {
        sttAudio.src = URL.createObjectURL(file);
        sttAudio.classList.remove('hidden');
        startAudioVisualization(sttAudio);
    }
}

// æ‹–æ‹½ä¸Šä¼ 
const zone = document.getElementById('upload-zone');
zone.ondragover = e => { e.preventDefault(); zone.classList.add('dragover'); };
zone.ondragleave = () => zone.classList.remove('dragover');
zone.ondrop = e => {
    e.preventDefault();
    zone.classList.remove('dragover');
    if(e.dataTransfer.files[0]) {
        document.getElementById('stt-file').files = e.dataTransfer.files;
        handleFileSelect(document.getElementById('stt-file'));
    }
};

let sttAudioContext = null;
let sttAnalyser = null;

function startAudioVisualization(audioElement) {
    const canvas = document.getElementById('stt-waveform');
    if(!canvas) return;
    canvas.classList.remove('hidden');
    
    // é‡ç”¨æˆ–åˆ›å»ºAudioContext
    if(!sttAudioContext) {
        sttAudioContext = new (window.AudioContext || window.webkitAudioContext)();
        sttAnalyser = sttAudioContext.createAnalyser();
        sttAnalyser.fftSize = 2048;
        
        try {
            const source = sttAudioContext.createMediaElementSource(audioElement);
            source.connect(sttAnalyser);
            sttAnalyser.connect(sttAudioContext.destination);
        } catch(e) {
            console.log('Audio source already connected, reusing...');
        }
    }
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const bufferLength = sttAnalyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);
    
    function draw() {
        if(audioElement.paused) return;
        requestAnimationFrame(draw);
        
        sttAnalyser.getByteFrequencyData(dataArray);
        
        const bgGradient = ctx.createLinearGradient(0, 0, 0, height);
        bgGradient.addColorStop(0, '#1a1a24');
        bgGradient.addColorStop(1, '#0a0a0f');
        ctx.fillStyle = bgGradient;
        ctx.fillRect(0, 0, width, height);
        
        const barWidth = (width / bufferLength) * 2.5;
        let x = 0;
        
        for(let i = 0; i < bufferLength; i++) {
            const barHeight = (dataArray[i] / 255) * height * 0.8;
            
            const barGradient = ctx.createLinearGradient(0, height - barHeight, 0, height);
            barGradient.addColorStop(0, '#ec4899');
            barGradient.addColorStop(0.5, '#8b5cf6');
            barGradient.addColorStop(1, '#3b82f6');
            
            ctx.fillStyle = barGradient;
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#ec4899';
            ctx.fillRect(x, height - barHeight, barWidth, barHeight);
            
            x += barWidth + 1;
        }
        ctx.shadowBlur = 0;
    }
    
    audioElement.onplay = () => draw();
}

async function testAPI() {
    const url = document.getElementById('api-url').value;
    const resultEl = document.getElementById('api-test-result');
    const testing = i18n[currentLanguage]['api.testing'] || 'æµ‹è¯•ä¸­...';
    const success = i18n[currentLanguage]['api.success'] || 'è¿æ¥æˆåŠŸ';
    const failed = i18n[currentLanguage]['api.failed'] || 'è¿æ¥å¤±è´¥';
    const models = i18n[currentLanguage]['api.models'] || 'æ¨¡å‹';
    const memory = i18n[currentLanguage]['api.memory'] || 'å†…å­˜';
    
    resultEl.textContent = testing;
    try {
        const res = await fetch(url + '/api/health');
        const data = await res.json();
        resultEl.style.color = 'var(--green)';
        resultEl.textContent = `âœ… ${success}ï¼${models}: ${data.models.tts.length + data.models.stt.length}ä¸ª, ${memory}: ${data.models.total_memory_mb.toFixed(0)}MB`;
        window.API_BASE = url;
    } catch(e) {
        resultEl.style.color = 'var(--red)';
        resultEl.textContent = `âŒ ${failed}: ${e.message}`;
    }
}

function toggleModelManager() {
    document.getElementById('model-manager').classList.toggle('hidden');
}

async function refreshModels() {
    try {
        const res = await fetch(API_BASE + '/api/health');
        if(!res.ok) throw new Error('API not ready');
        const data = await res.json();
        
        // ç´§å‡‘æ˜¾ç¤º
        const ttsCompact = document.getElementById('tts-models-compact');
        const sttCompact = document.getElementById('stt-models-compact');
        const memoryCompact = document.getElementById('memory-compact');
        
        if(!ttsCompact || !sttCompact) return;
        
        const notLoaded = i18n[currentLanguage]['model.notLoaded'] || 'æœªåŠ è½½';
        const unloadBtn = i18n[currentLanguage]['model.unload'] || 'å¸è½½';
        
        if(data.models.tts.length > 0) {
            ttsCompact.innerHTML = data.models.tts.map(m => m.split('/')[1].split('-')[0]).join(', ');
        } else {
            ttsCompact.textContent = notLoaded;
        }
        
        if(data.models.stt.length > 0) {
            sttCompact.innerHTML = data.models.stt.map(m => m.split('/')[1].replace('whisper-', '')).join(', ');
        } else {
            sttCompact.textContent = notLoaded;
        }
        
        // è¯¦ç»†åˆ—è¡¨
        const ttsDiv = document.getElementById('tts-models-list');
        const sttDiv = document.getElementById('stt-models-list');
        
        // ä¼°ç®—æ¯ä¸ªæ¨¡å‹å†…å­˜ï¼ˆç®€åŒ–ï¼‰
        const ttsMemory = data.models.tts.length > 0 ? (data.models.total_memory_mb * 0.3).toFixed(0) : 0;
        const sttMemory = data.models.stt.length > 0 ? (data.models.total_memory_mb * 0.7).toFixed(0) : 0;
        
        if(data.models.tts.length > 0) {
            ttsDiv.innerHTML = data.models.tts.map(m => {
                const name = m.split('/')[1];
                return `<div style="display:flex;justify-content:space-between;align-items:center;padding:.5rem;background:var(--surface2);border-radius:6px;margin-bottom:.5rem;font-size:.8rem">
                    <span>âœ… ${name}</span>
                    <div style="display:flex;gap:.5rem;align-items:center">
                        <span style="color:var(--accent)">${ttsMemory}MB</span>
                        <button onclick="unloadModel('${m}')" style="padding:.2rem .5rem;background:var(--red);border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:.7rem">${unloadBtn}</button>
                    </div>
                </div>`;
            }).join('');
        } else {
            ttsDiv.innerHTML = `<div style="color:var(--dim);font-size:.8rem">${notLoaded}</div>`;
        }
        
        if(data.models.stt.length > 0) {
            sttDiv.innerHTML = data.models.stt.map(m => {
                const name = m.split('/')[1];
                return `<div style="display:flex;justify-content:space-between;align-items:center;padding:.5rem;background:var(--surface2);border-radius:6px;margin-bottom:.5rem;font-size:.8rem">
                    <span>âœ… ${name}</span>
                    <div style="display:flex;gap:.5rem;align-items:center">
                        <span style="color:var(--accent)">${sttMemory}MB</span>
                        <button onclick="unloadModel('${m}')" style="padding:.2rem .5rem;background:var(--red);border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:.7rem">${unloadBtn}</button>
                    </div>
                </div>`;
            }).join('');
        } else {
            sttDiv.innerHTML = `<div style="color:var(--dim);font-size:.8rem">${notLoaded}</div>`;
        }
        
        // æ›´æ–°æ€»å†…å­˜ï¼ˆåªæ›´æ–°ç´§å‡‘æ˜¾ç¤ºï¼‰
        const totalMem = (data.models.total_memory_mb || 0).toFixed(0) + ' MB';
        const compactMem = document.getElementById('memory-compact');
        if(compactMem) compactMem.textContent = totalMem;
    } catch(e) {
        console.error('refreshModels error:', e);
    }
}

async function unloadModel(modelName) {
    if(!confirm(`ç¡®å®šå¸è½½ ${modelName}ï¼Ÿ`)) return;
    try {
        await fetch(`/v1/models/${encodeURIComponent(modelName)}`, {method: 'DELETE'});
        refreshModels();
    } catch(e) {
        alert('å¸è½½å¤±è´¥: ' + e.message);
    }
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing...');
    initializeLanguage();
    updateVoices();
    updatePromptCount();
    setTimeout(() => refreshModels(), 500);
    setInterval(refreshModels, 5000);
    console.log('Initialization complete');
    console.log('Voices loaded:', document.getElementById('tts-voice')?.options.length || 0);
});
</script>
</body>
</html>